(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{"7K4d":function(t,e,n){"use strict";n.r(e),n.d(e,"UploadModule",(function(){return Oe}));var i=n("ofXK"),r=n("tyNb"),s=n("mrSG"),o=n("XNiG"),a=n("zx2A");function l(t){return e=>e.lift(new u(t))}class u{constructor(t){this.notifier=t}call(t,e){const n=new c(t),i=Object(a.c)(this.notifier,new a.a(n));return i&&!n.seenValue?(n.add(i),e.subscribe(n)):n}}class c extends a.b{constructor(t){super(t),this.seenValue=!1}notifyNext(){this.seenValue=!0,this.complete()}notifyComplete(){}}const h=t=>"directory"===t.kind;function d(t){return t.isDirectory?t.entries.reduce((t,e)=>{const n=d(e);return t.concat(n)},[]):t.selected?[t]:[]}function f(t){return Object(s.b)(this,void 0,void 0,(function*(){const e=t.handle;if(!(yield function(t){return Object(s.b)(this,void 0,void 0,(function*(){return"granted"===(yield t.queryPermission())||"granted"===(yield t.requestPermission())}))}(e)))throw new Error("No permission to access the file.");return e.getFile()}))}function p(t,e){return Object(s.b)(this,void 0,void 0,(function*(){const n=e.map(e=>g(t,e));return(yield Promise.all(n)).filter(t=>!t).map((t,n)=>e[n])}))}const g=(t,e)=>Object(s.b)(void 0,void 0,void 0,(function*(){const n=t.map(t=>t.handle.isSameEntry(e.handle));return(yield Promise.all(n)).includes(!0)}));var b=n("fXoL"),m=n("2Vo4");function A(t,e,n,i){return Object(s.b)(this,void 0,void 0,(function*(){return new Promise((r,o)=>Object(s.b)(this,void 0,void 0,(function*(){const s=(yield Promise.resolve(t)).transaction(e,"readwrite").objectStore(e).put(n,i);s.onsuccess=t=>r(s.result),s.onerror=()=>o(s.error)})))}))}function _(t,e,n){return Object(s.b)(this,void 0,void 0,(function*(){return new Promise((i,r)=>Object(s.b)(this,void 0,void 0,(function*(){const s=(yield Promise.resolve(t)).transaction(e,"readonly").objectStore(e).get(n);s.onsuccess=t=>i(s.result),s.onerror=()=>r(s.error)})))}))}const v="usr";let y=(()=>{class t{constructor(){}db(){return this.db_||(this.db_=function(t){return new Promise((e,n)=>{const i=indexedDB.open(t.name,t.version);i.onsuccess=()=>{const n=i.result;n.onversionchange=function(){n.close(),t.versionConflictHandler()},e(n)},i.onerror=()=>n(i.error),i.onupgradeneeded=n=>Object(s.b)(this,void 0,void 0,(function*(){const r=i.result;if(i.transaction.oncomplete=()=>e(r),t.migration){const e=t.migration(r,n.oldVersion,n.newVersion);yield Promise.resolve(e)}}))})}({name:name,version:1,migration:w,versionConflictHandler:()=>alert("Code is outdated, please reload the page.")})),this.db_}getFolders(){return _(this.db(),v,"folders")}saveFolders(t){A(this.db(),v,t,"folders")}getQueue(){return _(this.db(),v,"queue")}saveQueue(t){A(this.db(),v,t,"queue")}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=b.Db({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();const w=(t,e,n)=>{console.log("Migrate from ",e,"to",n),t.objectStoreNames.contains(v)||t.createObjectStore(v)};let C=(()=>{class t{constructor(t){this.storage=t}get(){return this.queue||(this.queue=[],this.queue$=new m.a(this.queue),this.storage.getQueue().then(t=>{t&&this.restore(t)},()=>{})),this.queue$.asObservable()}restore(t){for(const e of t)e.status="pending";this.queue=t,this.queue$.next(this.queue)}add(t,e){return Object(s.b)(this,void 0,void 0,(function*(){const n=(yield p(this.queue.map(t=>t.entry),t)).map(t=>({name:t.path.map(t=>t.name).join("/")+"/"+t.name,added:new Date,entry:t,settings:e,size:0,progress:0,status:"pending",uploadFile:null,uploadSize:null}));this.queue.push(...n),this.queue.sort(I),this.queue$.next(this.queue),yield function(t){return Object(s.b)(this,void 0,void 0,(function*(){for(const e of t){const t=yield f(e.entry);e.size=t.size}}))}(n),this.save()}))}clear(){this.queue=[],this.queue$.next(this.queue),this.save()}save(){return Object(s.b)(this,void 0,void 0,(function*(){yield this.storage.saveQueue(this.queue.filter(t=>"done"!==t.status))}))}}return t.\u0275fac=function(e){return new(e||t)(b.Qb(y))},t.\u0275prov=b.Db({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();function I(t,e){return t.progress!==e.progress?(e.progress||0)-(t.progress||0):(t.settings.albumId||"").localeCompare(e.settings.albumId||"")}let E=(()=>{class t{constructor(){this.select$=new o.a,this.preview$=new o.a}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=b.Db({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),x=(()=>{class t{constructor(t){this.storage=t}get(){return this.folders||(this.folders=[],this.folders$=new m.a(this.folders),this.storage.getFolders().then(t=>{t&&(this.folders=t,this.folders$.next(this.folders))},()=>{})),this.folders$.asObservable()}add(t){return Object(s.b)(this,void 0,void 0,(function*(){t=Array.isArray(t)?t:[t],this.folders=yield B(this.folders,t),yield this.save(),this.folders$.next(this.folders)}))}remove(t){const e=this.folders.indexOf(t);this.folders=this.folders.slice(),this.folders.splice(e,1),this.folders$.next(this.folders),this.save()}save(){return Object(s.b)(this,void 0,void 0,(function*(){yield this.storage.saveFolders(this.folders)}))}}return t.\u0275fac=function(e){return new(e||t)(b.Qb(y))},t.\u0275prov=b.Db({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();const B=(t,e)=>Object(s.b)(void 0,void 0,void 0,(function*(){const n=yield p(t,e);return t.concat(n)}));var O=n("lJxs"),M=n("0MCZ"),k=n("Hu2g");function V(t,e){if(1&t&&(b.Mb(0,"span",12),b.oc(1),b.Xb(2,"async"),b.Lb()),2&t){const t=b.Wb();b.xb(1),b.qc(" (",b.Yb(2,1,t.queueLength),") ")}}const S=[[["","toolbar",""]],[["","content",""]]],j=function(){return{exact:!0}},Q=["[toolbar]","[content]"];let D=(()=>{class t{constructor(t){this.queue=t,this.unsubscribe=new o.a}ngOnInit(){this.queueLength=this.queue.get().pipe(Object(O.a)(t=>t.length))}ngOnDestroy(){this.unsubscribe.next(),this.unsubscribe.complete()}}return t.\u0275fac=function(e){return new(e||t)(b.Hb(C))},t.\u0275cmp=b.Bb({type:t,selectors:[["app-upload-layout"]],ngContentSelectors:Q,decls:20,vars:7,consts:[["sidebar",""],[1,"app-sidebar-main","pt-5"],[1,"app-sidebar-nav"],["routerLinkActive","app-active",3,"routerLinkActiveOptions"],["routerLink","/upload/queue",1,"d-flex"],["class","flex-grow-1 text-right",4,"ngIf"],["routerLink","/upload"],["toolbar",""],[1,"app-toolbar-btns"],[1,"app-toolbar-fill"],["content",""],[1,"container","py-5"],[1,"flex-grow-1","text-right"]],template:function(t,e){1&t&&(b.bc(S),b.Mb(0,"app-layout"),b.Kb(1,0),b.Mb(2,"div",1),b.Mb(3,"ul",2),b.Mb(4,"li",3),b.Mb(5,"a",4),b.oc(6," Uploads "),b.mc(7,V,3,3,"span",5),b.Xb(8,"async"),b.Lb(),b.Lb(),b.Mb(9,"li",3),b.Mb(10,"a",6),b.oc(11,"Select files"),b.Lb(),b.Lb(),b.Lb(),b.Lb(),b.Jb(),b.Kb(12,7),b.Mb(13,"div",8),b.ac(14),b.Ib(15,"div",9),b.Ib(16,"app-user-btn"),b.Lb(),b.Jb(),b.Kb(17,10),b.Mb(18,"div",11),b.ac(19,1),b.Lb(),b.Jb(),b.Lb()),2&t&&(b.xb(4),b.cc("routerLinkActiveOptions",b.ec(5,j)),b.xb(3),b.cc("ngIf",b.Yb(8,3,e.queueLength)),b.xb(2),b.cc("routerLinkActiveOptions",b.ec(6,j)))},directives:[M.a,r.a,r.b,i.l,k.a],pipes:[i.b],encapsulation:2}),t})(),L=(()=>{class t{getAlbums(){return this.albums?this.albums:this.loadAlbums()}loadAlbums(){return this.albums=this.loadMoreAlbums(void 0),this.albums}loadMoreAlbums(t){return Object(s.b)(this,void 0,void 0,(function*(){const e=yield(n=t,gapi.client.request({path:"https://photoslibrary.googleapis.com/v1/albums",method:"GET",params:{pageToken:n}}));var n;if(200!==e.status||!e.result.albums)return{albums:[],hasMore:!1};const i=e.result.nextPageToken;return{albums:e.result.albums,hasMore:i,loadMore:i?()=>this.loadMoreAlbums(e.result.nextPageToken):void 0}}))}uploadImage(t,e,n){return Object(s.b)(this,void 0,void 0,(function*(){return{uploadToken:yield function(t,e){return new Promise((n,i)=>{const r=t.slice(),s=new XMLHttpRequest;s.responseType="text",s.onreadystatechange=function(){s.readyState===XMLHttpRequest.DONE&&(200===s.status?n(s.responseText):i(s.status))},s.upload&&(s.upload.onprogress=t=>{e&&e(t.loaded/(t.total||1))}),s.open("POST","https://photoslibrary.googleapis.com/v1/uploads"),s.setRequestHeader("Content-type","application/octet-stream"),s.setRequestHeader("X-Goog-Upload-Content-Type","mime-type"),s.setRequestHeader("X-Goog-Upload-Protocol","raw"),s.setRequestHeader("Authorization","Bearer "+gapi.auth.getToken().access_token),s.send(r)})}(t,n)}}))}createMediaItems(t,e){return function(t,e){return Object(s.b)(this,void 0,void 0,(function*(){const n={albumId:e,newMediaItems:t.map(t=>({description:t.fileName,simpleMediaItem:{fileName:t.fileName,uploadToken:t.uploadToken}}))},i=yield gapi.client.request({path:"https://photoslibrary.googleapis.com/v1/mediaItems:batchCreate",method:"POST",body:n});console.log(i)}))}(t,e)}createAlbum(t){return Object(s.b)(this,void 0,void 0,(function*(){return(yield gapi.client.request({path:"https://photoslibrary.googleapis.com/v1/albums",method:"POST",body:{album:{title:t}}})).result}))}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=b.Db({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var U=n("HDdC"),T=n("DH7j"),q=n("XoHu"),P=n("Cfvw");function F(t,e){return new U.a(n=>{const i=t.length;if(0===i)return void n.complete();const r=new Array(i);let s=0,o=0;for(let a=0;a<i;a++){const l=Object(P.a)(t[a]);let u=!1;n.add(l.subscribe({next:t=>{u||(u=!0,o++),r[a]=t},error:t=>n.error(t),complete:()=>{s++,s!==i&&u||(o===i&&n.next(e?e.reduce((t,e,n)=>(t[e]=r[n],t),{}):r),n.complete())}}))}})}const H=new b.q("NgValueAccessor"),N={provide:H,useExisting:Object(b.S)(()=>R),multi:!0};let R=(()=>{class t{constructor(t,e){this._renderer=t,this._elementRef=e,this.onChange=t=>{},this.onTouched=()=>{}}writeValue(t){this._renderer.setProperty(this._elementRef.nativeElement,"checked",t)}registerOnChange(t){this.onChange=t}registerOnTouched(t){this.onTouched=t}setDisabledState(t){this._renderer.setProperty(this._elementRef.nativeElement,"disabled",t)}}return t.\u0275fac=function(e){return new(e||t)(b.Hb(b.D),b.Hb(b.l))},t.\u0275dir=b.Cb({type:t,selectors:[["input","type","checkbox","formControlName",""],["input","type","checkbox","formControl",""],["input","type","checkbox","ngModel",""]],hostBindings:function(t,e){1&t&&b.Tb("change",(function(t){return e.onChange(t.target.checked)}))("blur",(function(){return e.onTouched()}))},features:[b.wb([N])]}),t})();const z={provide:H,useExisting:Object(b.S)(()=>G),multi:!0},W=new b.q("CompositionEventMode");let G=(()=>{class t{constructor(t,e,n){this._renderer=t,this._elementRef=e,this._compositionMode=n,this.onChange=t=>{},this.onTouched=()=>{},this._composing=!1,null==this._compositionMode&&(this._compositionMode=!function(){const t=Object(i.u)()?Object(i.u)().getUserAgent():"";return/android (\d+)/.test(t.toLowerCase())}())}writeValue(t){this._renderer.setProperty(this._elementRef.nativeElement,"value",null==t?"":t)}registerOnChange(t){this.onChange=t}registerOnTouched(t){this.onTouched=t}setDisabledState(t){this._renderer.setProperty(this._elementRef.nativeElement,"disabled",t)}_handleInput(t){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(t)}_compositionStart(){this._composing=!0}_compositionEnd(t){this._composing=!1,this._compositionMode&&this.onChange(t)}}return t.\u0275fac=function(e){return new(e||t)(b.Hb(b.D),b.Hb(b.l),b.Hb(W,8))},t.\u0275dir=b.Cb({type:t,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(t,e){1&t&&b.Tb("input",(function(t){return e._handleInput(t.target.value)}))("blur",(function(){return e.onTouched()}))("compositionstart",(function(){return e._compositionStart()}))("compositionend",(function(t){return e._compositionEnd(t.target.value)}))},features:[b.wb([z])]}),t})(),$=(()=>{class t{get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}reset(t){this.control&&this.control.reset(t)}hasError(t,e){return!!this.control&&this.control.hasError(t,e)}getError(t,e){return this.control?this.control.getError(t,e):null}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275dir=b.Cb({type:t}),t})(),X=(()=>{class t extends ${get formDirective(){return null}get path(){return null}}return t.\u0275fac=function(e){return Y(e||t)},t.\u0275dir=b.Cb({type:t,features:[b.ub]}),t})();const Y=b.Ob(X);class Z extends ${constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null,this._rawValidators=[],this._rawAsyncValidators=[]}get validator(){}get asyncValidator(){}}let K=(()=>{class t extends class{constructor(t){this._cd=t}get ngClassUntouched(){return!!this._cd.control&&this._cd.control.untouched}get ngClassTouched(){return!!this._cd.control&&this._cd.control.touched}get ngClassPristine(){return!!this._cd.control&&this._cd.control.pristine}get ngClassDirty(){return!!this._cd.control&&this._cd.control.dirty}get ngClassValid(){return!!this._cd.control&&this._cd.control.valid}get ngClassInvalid(){return!!this._cd.control&&this._cd.control.invalid}get ngClassPending(){return!!this._cd.control&&this._cd.control.pending}}{constructor(t){super(t)}}return t.\u0275fac=function(e){return new(e||t)(b.Hb(Z,2))},t.\u0275dir=b.Cb({type:t,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(t,e){2&t&&b.zb("ng-untouched",e.ngClassUntouched)("ng-touched",e.ngClassTouched)("ng-pristine",e.ngClassPristine)("ng-dirty",e.ngClassDirty)("ng-valid",e.ngClassValid)("ng-invalid",e.ngClassInvalid)("ng-pending",e.ngClassPending)},features:[b.ub]}),t})();function J(t){return null==t||0===t.length}function tt(t){return null!=t&&"number"==typeof t.length}const et=new b.q("NgValidators"),nt=new b.q("NgAsyncValidators"),it=/^(?=.{1,254}$)(?=.{1,64}@)[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;class rt{static min(t){return e=>{if(J(e.value)||J(t))return null;const n=parseFloat(e.value);return!isNaN(n)&&n<t?{min:{min:t,actual:e.value}}:null}}static max(t){return e=>{if(J(e.value)||J(t))return null;const n=parseFloat(e.value);return!isNaN(n)&&n>t?{max:{max:t,actual:e.value}}:null}}static required(t){return J(t.value)?{required:!0}:null}static requiredTrue(t){return!0===t.value?null:{required:!0}}static email(t){return J(t.value)||it.test(t.value)?null:{email:!0}}static minLength(t){return e=>J(e.value)||!tt(e.value)?null:e.value.length<t?{minlength:{requiredLength:t,actualLength:e.value.length}}:null}static maxLength(t){return e=>tt(e.value)&&e.value.length>t?{maxlength:{requiredLength:t,actualLength:e.value.length}}:null}static pattern(t){if(!t)return rt.nullValidator;let e,n;return"string"==typeof t?(n="","^"!==t.charAt(0)&&(n+="^"),n+=t,"$"!==t.charAt(t.length-1)&&(n+="$"),e=new RegExp(n)):(n=t.toString(),e=t),t=>{if(J(t.value))return null;const i=t.value;return e.test(i)?null:{pattern:{requiredPattern:n,actualValue:i}}}}static nullValidator(t){return null}static compose(t){if(!t)return null;const e=t.filter(st);return 0==e.length?null:function(t){return at(lt(t,e))}}static composeAsync(t){if(!t)return null;const e=t.filter(st);return 0==e.length?null:function(t){return function(...t){if(1===t.length){const e=t[0];if(Object(T.a)(e))return F(e,null);if(Object(q.a)(e)&&Object.getPrototypeOf(e)===Object.prototype){const t=Object.keys(e);return F(t.map(t=>e[t]),t)}}if("function"==typeof t[t.length-1]){const e=t.pop();return F(t=1===t.length&&Object(T.a)(t[0])?t[0]:t,null).pipe(Object(O.a)(t=>e(...t)))}return F(t,null)}(lt(t,e).map(ot)).pipe(Object(O.a)(at))}}}function st(t){return null!=t}function ot(t){const e=Object(b.pb)(t)?Object(P.a)(t):t;return Object(b.ob)(e),e}function at(t){let e={};return t.forEach(t=>{e=null!=t?Object.assign(Object.assign({},e),t):e}),0===Object.keys(e).length?null:e}function lt(t,e){return e.map(e=>e(t))}function ut(t){return t.map(t=>function(t){return!t.validate}(t)?t:e=>t.validate(e))}const ct={provide:H,useExisting:Object(b.S)(()=>ht),multi:!0};let ht=(()=>{class t{constructor(t,e){this._renderer=t,this._elementRef=e,this.onChange=t=>{},this.onTouched=()=>{}}writeValue(t){this._renderer.setProperty(this._elementRef.nativeElement,"value",null==t?"":t)}registerOnChange(t){this.onChange=e=>{t(""==e?null:parseFloat(e))}}registerOnTouched(t){this.onTouched=t}setDisabledState(t){this._renderer.setProperty(this._elementRef.nativeElement,"disabled",t)}}return t.\u0275fac=function(e){return new(e||t)(b.Hb(b.D),b.Hb(b.l))},t.\u0275dir=b.Cb({type:t,selectors:[["input","type","number","formControlName",""],["input","type","number","formControl",""],["input","type","number","ngModel",""]],hostBindings:function(t,e){1&t&&b.Tb("input",(function(t){return e.onChange(t.target.value)}))("blur",(function(){return e.onTouched()}))},features:[b.wb([ct])]}),t})();const dt={provide:H,useExisting:Object(b.S)(()=>pt),multi:!0};let ft=(()=>{class t{constructor(){this._accessors=[]}add(t,e){this._accessors.push([t,e])}remove(t){for(let e=this._accessors.length-1;e>=0;--e)if(this._accessors[e][1]===t)return void this._accessors.splice(e,1)}select(t){this._accessors.forEach(e=>{this._isSameGroup(e,t)&&e[1]!==t&&e[1].fireUncheck(t.value)})}_isSameGroup(t,e){return!!t[0].control&&t[0]._parent===e._control._parent&&t[1].name===e.name}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=b.Db({token:t,factory:t.\u0275fac}),t})(),pt=(()=>{class t{constructor(t,e,n,i){this._renderer=t,this._elementRef=e,this._registry=n,this._injector=i,this.onChange=()=>{},this.onTouched=()=>{}}ngOnInit(){this._control=this._injector.get(Z),this._checkName(),this._registry.add(this._control,this)}ngOnDestroy(){this._registry.remove(this)}writeValue(t){this._state=t===this.value,this._renderer.setProperty(this._elementRef.nativeElement,"checked",this._state)}registerOnChange(t){this._fn=t,this.onChange=()=>{t(this.value),this._registry.select(this)}}fireUncheck(t){this.writeValue(t)}registerOnTouched(t){this.onTouched=t}setDisabledState(t){this._renderer.setProperty(this._elementRef.nativeElement,"disabled",t)}_checkName(){!this.name&&this.formControlName&&(this.name=this.formControlName)}}return t.\u0275fac=function(e){return new(e||t)(b.Hb(b.D),b.Hb(b.l),b.Hb(ft),b.Hb(b.r))},t.\u0275dir=b.Cb({type:t,selectors:[["input","type","radio","formControlName",""],["input","type","radio","formControl",""],["input","type","radio","ngModel",""]],hostBindings:function(t,e){1&t&&b.Tb("change",(function(){return e.onChange()}))("blur",(function(){return e.onTouched()}))},inputs:{name:"name",formControlName:"formControlName",value:"value"},features:[b.wb([dt])]}),t})();const gt={provide:H,useExisting:Object(b.S)(()=>bt),multi:!0};let bt=(()=>{class t{constructor(t,e){this._renderer=t,this._elementRef=e,this.onChange=t=>{},this.onTouched=()=>{}}writeValue(t){this._renderer.setProperty(this._elementRef.nativeElement,"value",parseFloat(t))}registerOnChange(t){this.onChange=e=>{t(""==e?null:parseFloat(e))}}registerOnTouched(t){this.onTouched=t}setDisabledState(t){this._renderer.setProperty(this._elementRef.nativeElement,"disabled",t)}}return t.\u0275fac=function(e){return new(e||t)(b.Hb(b.D),b.Hb(b.l))},t.\u0275dir=b.Cb({type:t,selectors:[["input","type","range","formControlName",""],["input","type","range","formControl",""],["input","type","range","ngModel",""]],hostBindings:function(t,e){1&t&&b.Tb("change",(function(t){return e.onChange(t.target.value)}))("input",(function(t){return e.onChange(t.target.value)}))("blur",(function(){return e.onTouched()}))},features:[b.wb([gt])]}),t})();const mt={provide:H,useExisting:Object(b.S)(()=>At),multi:!0};let At=(()=>{class t{constructor(t,e){this._renderer=t,this._elementRef=e,this._optionMap=new Map,this._idCounter=0,this.onChange=t=>{},this.onTouched=()=>{},this._compareWith=Object.is}set compareWith(t){this._compareWith=t}writeValue(t){this.value=t;const e=this._getOptionId(t);null==e&&this._renderer.setProperty(this._elementRef.nativeElement,"selectedIndex",-1);const n=function(t,e){return null==t?""+e:(e&&"object"==typeof e&&(e="Object"),`${t}: ${e}`.slice(0,50))}(e,t);this._renderer.setProperty(this._elementRef.nativeElement,"value",n)}registerOnChange(t){this.onChange=e=>{this.value=this._getOptionValue(e),t(this.value)}}registerOnTouched(t){this.onTouched=t}setDisabledState(t){this._renderer.setProperty(this._elementRef.nativeElement,"disabled",t)}_registerOption(){return(this._idCounter++).toString()}_getOptionId(t){for(const e of Array.from(this._optionMap.keys()))if(this._compareWith(this._optionMap.get(e),t))return e;return null}_getOptionValue(t){const e=function(t){return t.split(":")[0]}(t);return this._optionMap.has(e)?this._optionMap.get(e):t}}return t.\u0275fac=function(e){return new(e||t)(b.Hb(b.D),b.Hb(b.l))},t.\u0275dir=b.Cb({type:t,selectors:[["select","formControlName","",3,"multiple",""],["select","formControl","",3,"multiple",""],["select","ngModel","",3,"multiple",""]],hostBindings:function(t,e){1&t&&b.Tb("change",(function(t){return e.onChange(t.target.value)}))("blur",(function(){return e.onTouched()}))},inputs:{compareWith:"compareWith"},features:[b.wb([mt])]}),t})();const _t={provide:H,useExisting:Object(b.S)(()=>vt),multi:!0};let vt=(()=>{class t{constructor(t,e){this._renderer=t,this._elementRef=e,this._optionMap=new Map,this._idCounter=0,this.onChange=t=>{},this.onTouched=()=>{},this._compareWith=Object.is}set compareWith(t){this._compareWith=t}writeValue(t){let e;if(this.value=t,Array.isArray(t)){const n=t.map(t=>this._getOptionId(t));e=(t,e)=>{t._setSelected(n.indexOf(e.toString())>-1)}}else e=(t,e)=>{t._setSelected(!1)};this._optionMap.forEach(e)}registerOnChange(t){this.onChange=e=>{const n=[];if(void 0!==e.selectedOptions){const t=e.selectedOptions;for(let e=0;e<t.length;e++){const i=t.item(e),r=this._getOptionValue(i.value);n.push(r)}}else{const t=e.options;for(let e=0;e<t.length;e++){const i=t.item(e);if(i.selected){const t=this._getOptionValue(i.value);n.push(t)}}}this.value=n,t(n)}}registerOnTouched(t){this.onTouched=t}setDisabledState(t){this._renderer.setProperty(this._elementRef.nativeElement,"disabled",t)}_registerOption(t){const e=(this._idCounter++).toString();return this._optionMap.set(e,t),e}_getOptionId(t){for(const e of Array.from(this._optionMap.keys()))if(this._compareWith(this._optionMap.get(e)._value,t))return e;return null}_getOptionValue(t){const e=function(t){return t.split(":")[0]}(t);return this._optionMap.has(e)?this._optionMap.get(e)._value:t}}return t.\u0275fac=function(e){return new(e||t)(b.Hb(b.D),b.Hb(b.l))},t.\u0275dir=b.Cb({type:t,selectors:[["select","multiple","","formControlName",""],["select","multiple","","formControl",""],["select","multiple","","ngModel",""]],hostBindings:function(t,e){1&t&&b.Tb("change",(function(t){return e.onChange(t.target)}))("blur",(function(){return e.onTouched()}))},inputs:{compareWith:"compareWith"},features:[b.wb([_t])]}),t})();function yt(t,e){t._pendingDirty&&t.markAsDirty(),t.setValue(t._pendingValue,{emitModelToViewChange:!1}),e.viewToModelUpdate(t._pendingValue),t._pendingChange=!1}function wt(t){return null!=t?rt.compose(ut(t)):null}function Ct(t){return null!=t?rt.composeAsync(ut(t)):null}const It=[R,bt,ht,At,vt,pt],Et="VALID",xt="INVALID",Bt="PENDING",Ot="DISABLED";function Mt(t){return(jt(t)?t.validators:t)||null}function kt(t){return Array.isArray(t)?wt(t):t||null}function Vt(t,e){return(jt(e)?e.asyncValidators:t)||null}function St(t){return Array.isArray(t)?Ct(t):t||null}function jt(t){return null!=t&&!Array.isArray(t)&&"object"==typeof t}class Qt{constructor(t,e){this._hasOwnPendingAsyncValidator=!1,this._onCollectionChange=()=>{},this.pristine=!0,this.touched=!1,this._onDisabledChange=[],this._rawValidators=t,this._rawAsyncValidators=e,this._composedValidatorFn=kt(this._rawValidators),this._composedAsyncValidatorFn=St(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn}set validator(t){this._rawValidators=this._composedValidatorFn=t}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(t){this._rawAsyncValidators=this._composedAsyncValidatorFn=t}get parent(){return this._parent}get valid(){return this.status===Et}get invalid(){return this.status===xt}get pending(){return this.status==Bt}get disabled(){return this.status===Ot}get enabled(){return this.status!==Ot}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(t){this._rawValidators=t,this._composedValidatorFn=kt(t)}setAsyncValidators(t){this._rawAsyncValidators=t,this._composedAsyncValidatorFn=St(t)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(t={}){this.touched=!0,this._parent&&!t.onlySelf&&this._parent.markAsTouched(t)}markAllAsTouched(){this.markAsTouched({onlySelf:!0}),this._forEachChild(t=>t.markAllAsTouched())}markAsUntouched(t={}){this.touched=!1,this._pendingTouched=!1,this._forEachChild(t=>{t.markAsUntouched({onlySelf:!0})}),this._parent&&!t.onlySelf&&this._parent._updateTouched(t)}markAsDirty(t={}){this.pristine=!1,this._parent&&!t.onlySelf&&this._parent.markAsDirty(t)}markAsPristine(t={}){this.pristine=!0,this._pendingDirty=!1,this._forEachChild(t=>{t.markAsPristine({onlySelf:!0})}),this._parent&&!t.onlySelf&&this._parent._updatePristine(t)}markAsPending(t={}){this.status=Bt,!1!==t.emitEvent&&this.statusChanges.emit(this.status),this._parent&&!t.onlySelf&&this._parent.markAsPending(t)}disable(t={}){const e=this._parentMarkedDirty(t.onlySelf);this.status=Ot,this.errors=null,this._forEachChild(e=>{e.disable(Object.assign(Object.assign({},t),{onlySelf:!0}))}),this._updateValue(),!1!==t.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(Object.assign(Object.assign({},t),{skipPristineCheck:e})),this._onDisabledChange.forEach(t=>t(!0))}enable(t={}){const e=this._parentMarkedDirty(t.onlySelf);this.status=Et,this._forEachChild(e=>{e.enable(Object.assign(Object.assign({},t),{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:t.emitEvent}),this._updateAncestors(Object.assign(Object.assign({},t),{skipPristineCheck:e})),this._onDisabledChange.forEach(t=>t(!1))}_updateAncestors(t){this._parent&&!t.onlySelf&&(this._parent.updateValueAndValidity(t),t.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}setParent(t){this._parent=t}updateValueAndValidity(t={}){this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),this.status!==Et&&this.status!==Bt||this._runAsyncValidator(t.emitEvent)),!1!==t.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!t.onlySelf&&this._parent.updateValueAndValidity(t)}_updateTreeValidity(t={emitEvent:!0}){this._forEachChild(e=>e._updateTreeValidity(t)),this.updateValueAndValidity({onlySelf:!0,emitEvent:t.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?Ot:Et}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(t){if(this.asyncValidator){this.status=Bt,this._hasOwnPendingAsyncValidator=!0;const e=ot(this.asyncValidator(this));this._asyncValidationSubscription=e.subscribe(e=>{this._hasOwnPendingAsyncValidator=!1,this.setErrors(e,{emitEvent:t})})}}_cancelExistingSubscription(){this._asyncValidationSubscription&&(this._asyncValidationSubscription.unsubscribe(),this._hasOwnPendingAsyncValidator=!1)}setErrors(t,e={}){this.errors=t,this._updateControlsErrors(!1!==e.emitEvent)}get(t){return function(t,e,n){if(null==e)return null;if(Array.isArray(e)||(e=e.split(".")),Array.isArray(e)&&0===e.length)return null;let i=t;return e.forEach(t=>{i=i instanceof Lt?i.controls.hasOwnProperty(t)?i.controls[t]:null:i instanceof Ut&&i.at(t)||null}),i}(this,t)}getError(t,e){const n=e?this.get(e):this;return n&&n.errors?n.errors[t]:null}hasError(t,e){return!!this.getError(t,e)}get root(){let t=this;for(;t._parent;)t=t._parent;return t}_updateControlsErrors(t){this.status=this._calculateStatus(),t&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(t)}_initObservables(){this.valueChanges=new b.n,this.statusChanges=new b.n}_calculateStatus(){return this._allControlsDisabled()?Ot:this.errors?xt:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(Bt)?Bt:this._anyControlsHaveStatus(xt)?xt:Et}_anyControlsHaveStatus(t){return this._anyControls(e=>e.status===t)}_anyControlsDirty(){return this._anyControls(t=>t.dirty)}_anyControlsTouched(){return this._anyControls(t=>t.touched)}_updatePristine(t={}){this.pristine=!this._anyControlsDirty(),this._parent&&!t.onlySelf&&this._parent._updatePristine(t)}_updateTouched(t={}){this.touched=this._anyControlsTouched(),this._parent&&!t.onlySelf&&this._parent._updateTouched(t)}_isBoxedValue(t){return"object"==typeof t&&null!==t&&2===Object.keys(t).length&&"value"in t&&"disabled"in t}_registerOnCollectionChange(t){this._onCollectionChange=t}_setUpdateStrategy(t){jt(t)&&null!=t.updateOn&&(this._updateOn=t.updateOn)}_parentMarkedDirty(t){return!t&&this._parent&&this._parent.dirty&&!this._parent._anyControlsDirty()}}class Dt extends Qt{constructor(t=null,e,n){super(Mt(e),Vt(n,e)),this._onChange=[],this._applyFormState(t),this._setUpdateStrategy(e),this.updateValueAndValidity({onlySelf:!0,emitEvent:!1}),this._initObservables()}setValue(t,e={}){this.value=this._pendingValue=t,this._onChange.length&&!1!==e.emitModelToViewChange&&this._onChange.forEach(t=>t(this.value,!1!==e.emitViewToModelChange)),this.updateValueAndValidity(e)}patchValue(t,e={}){this.setValue(t,e)}reset(t=null,e={}){this._applyFormState(t),this.markAsPristine(e),this.markAsUntouched(e),this.setValue(this.value,e),this._pendingChange=!1}_updateValue(){}_anyControls(t){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(t){this._onChange.push(t)}_clearChangeFns(){this._onChange=[],this._onDisabledChange=[],this._onCollectionChange=()=>{}}registerOnDisabledChange(t){this._onDisabledChange.push(t)}_forEachChild(t){}_syncPendingControls(){return!("submit"!==this.updateOn||(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),!this._pendingChange)||(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),0))}_applyFormState(t){this._isBoxedValue(t)?(this.value=this._pendingValue=t.value,t.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=t}}class Lt extends Qt{constructor(t,e,n){super(Mt(e),Vt(n,e)),this.controls=t,this._initObservables(),this._setUpdateStrategy(e),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!1})}registerControl(t,e){return this.controls[t]?this.controls[t]:(this.controls[t]=e,e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange),e)}addControl(t,e){this.registerControl(t,e),this.updateValueAndValidity(),this._onCollectionChange()}removeControl(t){this.controls[t]&&this.controls[t]._registerOnCollectionChange(()=>{}),delete this.controls[t],this.updateValueAndValidity(),this._onCollectionChange()}setControl(t,e){this.controls[t]&&this.controls[t]._registerOnCollectionChange(()=>{}),delete this.controls[t],e&&this.registerControl(t,e),this.updateValueAndValidity(),this._onCollectionChange()}contains(t){return this.controls.hasOwnProperty(t)&&this.controls[t].enabled}setValue(t,e={}){this._checkAllValuesPresent(t),Object.keys(t).forEach(n=>{this._throwIfControlMissing(n),this.controls[n].setValue(t[n],{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e)}patchValue(t,e={}){Object.keys(t).forEach(n=>{this.controls[n]&&this.controls[n].patchValue(t[n],{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e)}reset(t={},e={}){this._forEachChild((n,i)=>{n.reset(t[i],{onlySelf:!0,emitEvent:e.emitEvent})}),this._updatePristine(e),this._updateTouched(e),this.updateValueAndValidity(e)}getRawValue(){return this._reduceChildren({},(t,e,n)=>(t[n]=e instanceof Dt?e.value:e.getRawValue(),t))}_syncPendingControls(){let t=this._reduceChildren(!1,(t,e)=>!!e._syncPendingControls()||t);return t&&this.updateValueAndValidity({onlySelf:!0}),t}_throwIfControlMissing(t){if(!Object.keys(this.controls).length)throw new Error("\n        There are no form controls registered with this group yet. If you're using ngModel,\n        you may want to check next tick (e.g. use setTimeout).\n      ");if(!this.controls[t])throw new Error(`Cannot find form control with name: ${t}.`)}_forEachChild(t){Object.keys(this.controls).forEach(e=>t(this.controls[e],e))}_setUpControls(){this._forEachChild(t=>{t.setParent(this),t._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(t){for(const e of Object.keys(this.controls)){const n=this.controls[e];if(this.contains(e)&&t(n))return!0}return!1}_reduceValue(){return this._reduceChildren({},(t,e,n)=>((e.enabled||this.disabled)&&(t[n]=e.value),t))}_reduceChildren(t,e){let n=t;return this._forEachChild((t,i)=>{n=e(n,t,i)}),n}_allControlsDisabled(){for(const t of Object.keys(this.controls))if(this.controls[t].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_checkAllValuesPresent(t){this._forEachChild((e,n)=>{if(void 0===t[n])throw new Error(`Must supply a value for form control with name: '${n}'.`)})}}class Ut extends Qt{constructor(t,e,n){super(Mt(e),Vt(n,e)),this.controls=t,this._initObservables(),this._setUpdateStrategy(e),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!1})}at(t){return this.controls[t]}push(t){this.controls.push(t),this._registerControl(t),this.updateValueAndValidity(),this._onCollectionChange()}insert(t,e){this.controls.splice(t,0,e),this._registerControl(e),this.updateValueAndValidity()}removeAt(t){this.controls[t]&&this.controls[t]._registerOnCollectionChange(()=>{}),this.controls.splice(t,1),this.updateValueAndValidity()}setControl(t,e){this.controls[t]&&this.controls[t]._registerOnCollectionChange(()=>{}),this.controls.splice(t,1),e&&(this.controls.splice(t,0,e),this._registerControl(e)),this.updateValueAndValidity(),this._onCollectionChange()}get length(){return this.controls.length}setValue(t,e={}){this._checkAllValuesPresent(t),t.forEach((t,n)=>{this._throwIfControlMissing(n),this.at(n).setValue(t,{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e)}patchValue(t,e={}){t.forEach((t,n)=>{this.at(n)&&this.at(n).patchValue(t,{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e)}reset(t=[],e={}){this._forEachChild((n,i)=>{n.reset(t[i],{onlySelf:!0,emitEvent:e.emitEvent})}),this._updatePristine(e),this._updateTouched(e),this.updateValueAndValidity(e)}getRawValue(){return this.controls.map(t=>t instanceof Dt?t.value:t.getRawValue())}clear(){this.controls.length<1||(this._forEachChild(t=>t._registerOnCollectionChange(()=>{})),this.controls.splice(0),this.updateValueAndValidity())}_syncPendingControls(){let t=this.controls.reduce((t,e)=>!!e._syncPendingControls()||t,!1);return t&&this.updateValueAndValidity({onlySelf:!0}),t}_throwIfControlMissing(t){if(!this.controls.length)throw new Error("\n        There are no form controls registered with this array yet. If you're using ngModel,\n        you may want to check next tick (e.g. use setTimeout).\n      ");if(!this.at(t))throw new Error("Cannot find form control at index "+t)}_forEachChild(t){this.controls.forEach((e,n)=>{t(e,n)})}_updateValue(){this.value=this.controls.filter(t=>t.enabled||this.disabled).map(t=>t.value)}_anyControls(t){return this.controls.some(e=>e.enabled&&t(e))}_setUpControls(){this._forEachChild(t=>this._registerControl(t))}_checkAllValuesPresent(t){this._forEachChild((e,n)=>{if(void 0===t[n])throw new Error(`Must supply a value for form control at index: ${n}.`)})}_allControlsDisabled(){for(const t of this.controls)if(t.enabled)return!1;return this.controls.length>0||this.disabled}_registerControl(t){t.setParent(this),t._registerOnCollectionChange(this._onCollectionChange)}}const Tt={provide:Z,useExisting:Object(b.S)(()=>Pt)},qt=(()=>Promise.resolve(null))();let Pt=(()=>{class t extends Z{constructor(t,e,n,i){super(),this.control=new Dt,this._registered=!1,this.update=new b.n,this._parent=t,this._rawValidators=e||[],this._rawAsyncValidators=n||[],this.valueAccessor=function(t,e){if(!e)return null;Array.isArray(e);let n=void 0,i=void 0,r=void 0;return e.forEach(t=>{var e;t.constructor===G?n=t:(e=t,It.some(t=>e.constructor===t)?i=t:r=t)}),r||i||n||null}(0,i)}ngOnChanges(t){this._checkForErrors(),this._registered||this._setUpControl(),"isDisabled"in t&&this._updateDisabled(t),function(t,e){if(!t.hasOwnProperty("model"))return!1;const n=t.model;return!!n.isFirstChange()||!Object.is(e,n.currentValue)}(t,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._parent?function(t,e){return[...e.path,t]}(this.name,this._parent):[this.name]}get formDirective(){return this._parent?this._parent.formDirective:null}get validator(){return wt(this._rawValidators)}get asyncValidator(){return Ct(this._rawAsyncValidators)}viewToModelUpdate(t){this.viewModel=t,this.update.emit(t)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!(!this.options||!this.options.standalone)}_setUpStandalone(){var t,e;(t=this.control).validator=rt.compose([t.validator,(e=this).validator]),t.asyncValidator=rt.composeAsync([t.asyncValidator,e.asyncValidator]),e.valueAccessor.writeValue(t.value),function(t,e){e.valueAccessor.registerOnChange(n=>{t._pendingValue=n,t._pendingChange=!0,t._pendingDirty=!0,"change"===t.updateOn&&yt(t,e)})}(t,e),function(t,e){t.registerOnChange((t,n)=>{e.valueAccessor.writeValue(t),n&&e.viewToModelUpdate(t)})}(t,e),function(t,e){e.valueAccessor.registerOnTouched(()=>{t._pendingTouched=!0,"blur"===t.updateOn&&t._pendingChange&&yt(t,e),"submit"!==t.updateOn&&t.markAsTouched()})}(t,e),e.valueAccessor.setDisabledState&&t.registerOnDisabledChange(t=>{e.valueAccessor.setDisabledState(t)}),e._rawValidators.forEach(e=>{e.registerOnValidatorChange&&e.registerOnValidatorChange(()=>t.updateValueAndValidity())}),e._rawAsyncValidators.forEach(e=>{e.registerOnValidatorChange&&e.registerOnValidatorChange(()=>t.updateValueAndValidity())}),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._isStandalone()||this._checkParentType(),this._checkName()}_checkParentType(){}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),this._isStandalone()}_updateValue(t){qt.then(()=>{this.control.setValue(t,{emitViewToModelChange:!1})})}_updateDisabled(t){const e=t.isDisabled.currentValue,n=""===e||e&&"false"!==e;qt.then(()=>{n&&!this.control.disabled?this.control.disable():!n&&this.control.disabled&&this.control.enable()})}}return t.\u0275fac=function(e){return new(e||t)(b.Hb(X,9),b.Hb(et,10),b.Hb(nt,10),b.Hb(H,10))},t.\u0275dir=b.Cb({type:t,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:["disabled","isDisabled"],model:["ngModel","model"],options:["ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],features:[b.wb([Tt]),b.ub,b.vb]}),t})(),Ft=(()=>{class t{}return t.\u0275mod=b.Fb({type:t}),t.\u0275inj=b.Eb({factory:function(e){return new(e||t)}}),t})(),Ht=(()=>{class t{}return t.\u0275mod=b.Fb({type:t}),t.\u0275inj=b.Eb({factory:function(e){return new(e||t)},providers:[ft],imports:[Ft]}),t})();var Nt=n("aq5N"),Rt=n("IY4n");function zt(t,e){1&t&&(b.Mb(0,"div"),b.oc(1,"Loading albums..."),b.Lb())}function Wt(t,e){1&t&&(b.Vb(),b.Ib(0,"svg",19))}function Gt(t,e){if(1&t){const t=b.Nb();b.Mb(0,"div",16),b.Tb("click",(function(){b.ic(t);const n=e.$implicit;return b.Wb().selectAlbum(n)})),b.Ib(1,"img",17),b.Xb(2,"imageUrl"),b.mc(3,Wt,1,0,"svg",18),b.Mb(4,"div"),b.oc(5),b.Lb(),b.Lb()}if(2&t){const t=e.$implicit,n=b.Wb();b.zb("app-selected",t==n.selectedAlbum),b.xb(1),b.cc("src",b.Zb(2,5,t.coverPhotoBaseUrl,50),b.jc),b.xb(2),b.cc("ngIf",!t.isWriteable),b.xb(2),b.pc(t.title)}}function $t(t,e){if(1&t){const t=b.Nb();b.Mb(0,"input",20),b.Tb("ngModelChange",(function(e){return b.ic(t),b.Wb().newAlbumName=e})),b.Lb()}if(2&t){const t=b.Wb();b.cc("ngModel",t.newAlbumName)}}function Xt(t,e){if(1&t){const t=b.Nb();b.Mb(0,"div",1),b.Mb(1,"label",21),b.oc(2,"Max. width/height"),b.Lb(),b.Mb(3,"input",22),b.Tb("ngModelChange",(function(e){return b.ic(t),b.Wb().settings.maxSize=e})),b.Lb(),b.Lb()}if(2&t){const t=b.Wb();b.xb(3),b.cc("ngModel",t.settings.maxSize)}}const Yt=function(t,e){return{"btn-outline-primary":t,"btn-primary":e}};let Zt=(()=>{class t{constructor(t){this.photoService=t,this.close=new b.n,this.settings={albumName:"",albumId:"",resize:!0,maxSize:4e3},this.albums=[],this.loadingAlbums=!0,this.creatingAlbum=!1,this.loadingAlbum=!1,this.newAlbumName=""}ngOnInit(){return Object(s.b)(this,void 0,void 0,(function*(){try{let t=()=>this.photoService.getAlbums();for(;;){const e=yield t();if([].push.apply(this.albums,e.albums),!e.hasMore)break;t=e.loadMore}}finally{this.loadingAlbums=!1}}))}selectAlbum(t){t.isWriteable&&(this.selectedAlbum=t,this.settings.albumId=t.id,this.settings.albumName=t.title)}createAlbum(){return Object(s.b)(this,void 0,void 0,(function*(){if(this.creatingAlbum){if(this.newAlbumName){this.loadingAlbum=!0;try{const t=yield this.photoService.createAlbum(this.newAlbumName);this.albums.unshift(t),this.selectAlbum(t),this.creatingAlbum=!1}finally{this.loadingAlbum=!1}}}else this.creatingAlbum=!0}))}}return t.\u0275fac=function(e){return new(e||t)(b.Hb(L))},t.\u0275cmp=b.Bb({type:t,selectors:[["app-upload-settings"]],outputs:{close:"close"},decls:24,vars:10,consts:[[1,"mb-5"],[1,"form-group"],[4,"ngIf"],[1,"app-upload-albums"],["class","app-upload-album",3,"app-selected","click",4,"ngFor","ngForOf"],["type","text","class","form-control mb-2","placeholder","New album name...",3,"ngModel","ngModelChange",4,"ngIf"],["type","button",1,"btn",3,"ngClass","disabled","click"],[1,"row","mb-5"],[1,"col-lg-6"],[1,"form-check"],["type","checkbox","id","resize",1,"form-check-input",3,"ngModel","ngModelChange"],["for","resize",1,"form-check-label"],["class","form-group",4,"ngIf"],[1,"mt-5"],["type","button",1,"btn","btn-primary",3,"click"],["type","button",1,"btn","btn-outline-primary","ml-2",3,"click"],[1,"app-upload-album",3,"click"],["alt","",3,"src"],["appIcon","lockOutline",4,"ngIf"],["appIcon","lockOutline"],["type","text","placeholder","New album name...",1,"form-control","mb-2",3,"ngModel","ngModelChange"],["for","album"],["type","number","placeholders","",1,"form-control",3,"ngModel","ngModelChange"]],template:function(t,e){1&t&&(b.Mb(0,"div",0),b.Mb(1,"div",1),b.Mb(2,"label"),b.oc(3,"Select album"),b.Lb(),b.mc(4,zt,2,0,"div",2),b.Mb(5,"div",3),b.mc(6,Gt,6,8,"div",4),b.Lb(),b.Lb(),b.Mb(7,"div",1),b.mc(8,$t,1,1,"input",5),b.Mb(9,"button",6),b.Tb("click",(function(){return e.createAlbum()})),b.oc(10," Create album "),b.Lb(),b.Lb(),b.Lb(),b.Mb(11,"div",7),b.Mb(12,"div",8),b.Mb(13,"div",1),b.Mb(14,"div",9),b.Mb(15,"input",10),b.Tb("ngModelChange",(function(t){return e.settings.resize=t})),b.Lb(),b.Mb(16,"label",11),b.oc(17,"Resize before upload"),b.Lb(),b.Lb(),b.Lb(),b.mc(18,Xt,4,1,"div",12),b.Mb(19,"div",13),b.Mb(20,"button",14),b.Tb("click",(function(){return e.close.emit(e.settings)})),b.oc(21," Upload "),b.Lb(),b.Mb(22,"button",15),b.Tb("click",(function(){return e.close.emit(null)})),b.oc(23," Cancel "),b.Lb(),b.Lb(),b.Lb(),b.Lb()),2&t&&(b.xb(4),b.cc("ngIf",e.loadingAlbums),b.xb(2),b.cc("ngForOf",e.albums),b.xb(2),b.cc("ngIf",e.creatingAlbum),b.xb(1),b.cc("ngClass",b.fc(7,Yt,!e.creatingAlbum,e.creatingAlbum))("disabled",e.loadingAlbum),b.xb(6),b.cc("ngModel",e.settings.resize),b.xb(3),b.cc("ngIf",e.settings.resize))},directives:[i.l,i.k,i.j,R,K,Pt,Nt.a,G,ht],pipes:[Rt.a],encapsulation:2}),t})();function Kt(t,e){1&t&&(b.Vb(),b.Ib(0,"svg",8))}function Jt(t,e){1&t&&(b.Vb(),b.Ib(0,"svg",9))}function te(t,e){if(1&t&&b.Ib(0,"app-file-folder-entry",13),2&t){const t=b.Wb().$implicit,e=b.Wb(2);b.cc("entry",t)("level",e.level+1)}}function ee(t,e){if(1&t){const t=b.Nb();b.Mb(0,"div",0),b.Mb(1,"input",1),b.Tb("click",(function(e){b.ic(t);const n=b.Wb().$implicit;return b.Wb(2).onSelect(n,e)})),b.Lb(),b.Mb(2,"div",14),b.Mb(3,"a",3),b.Tb("click",(function(){b.ic(t);const e=b.Wb().$implicit;return b.Wb(2).show(e)})),b.Vb(),b.Ib(4,"svg",15),b.oc(5),b.Lb(),b.Lb(),b.Lb()}if(2&t){const t=b.Wb().$implicit,e=b.Wb(2);b.xb(1),b.cc("checked",t.selected),b.xb(1),b.lc("padding-left",e.level+1,"em"),b.xb(3),b.qc(" ",t.name," ")}}function ne(t,e){if(1&t&&(b.Kb(0),b.mc(1,te,1,2,"app-file-folder-entry",11),b.mc(2,ee,6,4,"ng-template",null,12,b.nc),b.Jb()),2&t){const t=e.$implicit,n=b.hc(3);b.xb(1),b.cc("ngIf",t.isDirectory)("ngIfElse",n)}}function ie(t,e){if(1&t&&(b.Kb(0),b.mc(1,ne,4,2,"ng-container",10),b.Jb()),2&t){const t=b.Wb();b.xb(1),b.cc("ngForOf",t.entry.entries)}}let re=(()=>{class t{constructor(t){this.service=t,this.showEntries=!1}ngOnInit(){this.fileCount=function t(e){return e.isDirectory?e.entries.reduce((e,n)=>e+t(n),0):1}(this.entry)}toggle(){this.showEntries=!this.showEntries}onSelect(t,e){this.service.select$.next({entry:t,shiftKey:e.shiftKey})}show(t){return Object(s.b)(this,void 0,void 0,(function*(){t.isDirectory||this.service.preview$.next(t)}))}}return t.\u0275fac=function(e){return new(e||t)(b.Hb(E))},t.\u0275cmp=b.Bb({type:t,selectors:[["app-file-folder-entry"]],inputs:{entry:"entry",level:"level"},decls:11,vars:8,consts:[[1,"app-browser-entry"],["type","checkbox",3,"checked","click"],[1,"app-folder-entry"],["href","javascript:void(0)",3,"click"],["appIcon","folderOpenOutline","size","20",4,"ngIf","ngIfElse"],["closedFolder",""],[1,"app-file-count"],[4,"ngIf"],["appIcon","folderOpenOutline","size","20"],["appIcon","folderOutline","size","20"],[4,"ngFor","ngForOf"],[3,"entry","level",4,"ngIf","ngIfElse"],["fileEntry",""],[3,"entry","level"],[1,"app-file-entry"],["appIcon","fileImageOutline","size","20"]],template:function(t,e){if(1&t&&(b.Mb(0,"div",0),b.Mb(1,"input",1),b.Tb("click",(function(t){return e.onSelect(e.entry,t)})),b.Lb(),b.Mb(2,"div",2),b.Mb(3,"a",3),b.Tb("click",(function(){return e.toggle()})),b.mc(4,Kt,1,0,"svg",4),b.mc(5,Jt,1,0,"ng-template",null,5,b.nc),b.oc(7),b.Mb(8,"span",6),b.oc(9),b.Lb(),b.Lb(),b.Lb(),b.Lb(),b.mc(10,ie,2,1,"ng-container",7)),2&t){const t=b.hc(6);b.xb(1),b.cc("checked",e.entry.selected),b.xb(1),b.lc("padding-left",e.level,"em"),b.xb(2),b.cc("ngIf",e.showEntries)("ngIfElse",t),b.xb(3),b.qc(" ",e.entry.name," "),b.xb(2),b.qc("(",e.fileCount,")"),b.xb(1),b.cc("ngIf",e.showEntries)}},directives:[i.l,Nt.a,i.k,t],encapsulation:2}),t})(),se=(()=>{class t{constructor(t){this.service=t,this.select=new b.n,this.unsubscribe$=new o.a}ngOnInit(){}ngOnDestroy(){this.unsubscribe$.next(),this.unsubscribe$.complete()}}return t.\u0275fac=function(e){return new(e||t)(b.Hb(E))},t.\u0275cmp=b.Bb({type:t,selectors:[["app-file-browser"]],inputs:{folder:"folder"},outputs:{select:"select"},decls:2,vars:2,consts:[[1,"app-file-browser-list"],[3,"entry","level"]],template:function(t,e){1&t&&(b.Mb(0,"div",0),b.Ib(1,"app-file-folder-entry",1),b.Lb()),2&t&&(b.xb(1),b.cc("entry",e.folder)("level",1))},directives:[re],encapsulation:2}),t})();var oe=n("jhN1");let ae=(()=>{class t{constructor(t){this.sanitizer=t}onInit(){}ngOnDestroy(){this.cleanup()}cleanup(){this.imgUrl&&URL.revokeObjectURL(this.imgUrl),this.imgUrl2&&URL.revokeObjectURL(this.imgUrl2)}ngOnChanges(){this.cleanup(),this.file&&(this.imgUrl=URL.createObjectURL(this.file),this.imgSrc=this.sanitizer.bypassSecurityTrustUrl(this.imgUrl))}}return t.\u0275fac=function(e){return new(e||t)(b.Hb(oe.b))},t.\u0275cmp=b.Bb({type:t,selectors:[["app-image-preview"]],inputs:{file:"file"},features:[b.vb],decls:2,vars:1,consts:[[1,"app-image-preview"],["alt","",3,"src"]],template:function(t,e){1&t&&(b.Mb(0,"div",0),b.Ib(1,"img",1),b.Lb()),2&t&&(b.xb(1),b.cc("src",e.imgSrc,b.jc))},encapsulation:2}),t})();const le=function(t,e){return{"btn-outline-primary":t,"btn-primary":e}};function ue(t,e){if(1&t){const t=b.Nb();b.Kb(0),b.Mb(1,"button",7),b.Tb("click",(function(){return b.ic(t),b.Wb().openFolder()})),b.oc(2," Add folder "),b.Lb(),b.Mb(3,"button",8),b.Tb("click",(function(){return b.ic(t),b.Wb().showSettings=!0})),b.oc(4," Upload "),b.Lb(),b.Jb()}if(2&t){const t=b.Wb();b.xb(1),b.cc("ngClass",b.fc(3,le,t.canSelect,!t.canSelect)),b.xb(2),b.cc("disabled",!t.canSelect)("ngClass",b.fc(6,le,!t.canSelect,t.canSelect))}}function ce(t,e){if(1&t){const t=b.Nb();b.Mb(0,"app-upload-settings",9),b.Tb("close",(function(e){return b.ic(t),b.Wb().upload(e)})),b.Lb()}}function he(t,e){1&t&&(b.Mb(0,"div",10),b.oc(1,"Reading folder..."),b.Lb())}function de(t,e){if(1&t){const t=b.Nb();b.Mb(0,"div"),b.Mb(1,"div",11),b.Mb(2,"a",12),b.Tb("click",(function(){b.ic(t);const n=e.$implicit;return b.Wb().remove(n)})),b.oc(3,"Remove"),b.Lb(),b.Lb(),b.Ib(4,"app-file-browser",13),b.Lb()}if(2&t){const t=e.$implicit;b.xb(4),b.cc("folder",t)}}function fe(t,e){if(1&t){const t=b.Nb();b.Mb(0,"div",14),b.Mb(1,"div"),b.Mb(2,"a",12),b.Tb("click",(function(){return b.ic(t),b.Wb().show()})),b.oc(3,"Close"),b.Lb(),b.Lb(),b.Ib(4,"app-image-preview",15),b.Lb()}if(2&t){const t=b.Wb();b.xb(4),b.cc("file",t.imageFile)}}let pe=(()=>{class t{constructor(t,e,n){this.queue=t,this.browserService=e,this.folderService=n,this.folders=[],this.unsubscribe$=new o.a}ngOnInit(){this.folderService.get().pipe(l(this.unsubscribe$)).subscribe(t=>Object(s.b)(this,void 0,void 0,(function*(){this.folders=t}))),this.browserService.preview$.pipe(l(this.unsubscribe$)).subscribe(t=>this.show(t)),this.browserService.select$.pipe(l(this.unsubscribe$)).subscribe(t=>this.onSelect(t)),this.updateSelection()}ngOnDestroy(){this.unsubscribe$.next(),this.unsubscribe$.complete()}openFolder(){return Object(s.b)(this,void 0,void 0,(function*(){this.loading=!0;try{const t=yield function(){return Object(s.b)(this,void 0,void 0,(function*(){const t=window,e=yield t.showDirectoryPicker();return yield function t(e,n){var i,r;return Object(s.b)(this,void 0,void 0,(function*(){const o={name:e.name,path:n,entries:[],isDirectory:h(e),handle:e};if(h(e)){const c=e;try{for(var a,l=Object(s.a)(c.values());!(a=yield l.next()).done;){const e=a.value;o.entries.push(yield t(e,n.concat(o)))}}catch(u){i={error:u}}finally{try{a&&!a.done&&(r=l.return)&&(yield r.call(l))}finally{if(i)throw i.error}}}return o.entries=o.entries.filter(t=>t.isDirectory||function(t){const e=t.name.split(".").pop().toLocaleLowerCase();return"jpg"===e||"jpeg"===e}(t)).sort((t,e)=>h(t)===h(e)?t.name.localeCompare(e.name):h(t)?1:-1),o}))}(e,[])}))}();this.folderService.add(t)}finally{this.loading=!1}}))}onSelect(t){const{entry:e,shiftKey:n}=t;if(n&&this.selected){const t=this.selected.path[this.selected.path.length-1];let n=t.entries.indexOf(this.selected),i=t.entries.indexOf(e);if(n>i){const t=i;i=n,n=t}t.entries.slice(n,i+1).forEach(ge(this.selected.selected))}else be(e,!e.selected);this.selected=e,this.updateSelection()}updateSelection(){const t=this.folders.map(d);this.selection=[].concat.apply([],t),this.canSelect=!!this.selection.length}upload(t){t&&(this.queue.add(this.selection,{albumId:t.albumId,albumName:t.albumName,maxSize:t.resize?t.maxSize:void 0}),this.selection.forEach(t=>t.selected=!1)),this.showSettings=!1}remove(t){this.folderService.remove(t)}show(t){return Object(s.b)(this,void 0,void 0,(function*(){t||(this.imageFile=null),t&&(this.imageFile=yield f(t))}))}}return t.\u0275fac=function(e){return new(e||t)(b.Hb(C),b.Hb(E),b.Hb(x))},t.\u0275cmp=b.Bb({type:t,selectors:[["app-select-files"]],decls:10,vars:5,consts:[["content",""],[4,"ngIf","ngIfElse"],["uploadSettings",""],["class","my-5",4,"ngIf"],[1,"app-folders","py-4"],[4,"ngFor","ngForOf"],["class","app-image-preview-container",4,"ngIf"],["type","button",1,"btn","mr-2",3,"ngClass","click"],["type","button",1,"btn",3,"disabled","ngClass","click"],[3,"close"],[1,"my-5"],[1,"text-right"],["href","javascript:void(0)",3,"click"],[3,"folder"],[1,"app-image-preview-container"],[3,"file"]],template:function(t,e){if(1&t&&(b.Mb(0,"app-upload-layout"),b.Kb(1,0),b.mc(2,ue,5,9,"ng-container",1),b.mc(3,ce,1,0,"ng-template",null,2,b.nc),b.mc(5,he,2,0,"div",3),b.Mb(6,"div",4),b.Mb(7,"div"),b.mc(8,de,5,1,"div",5),b.Lb(),b.mc(9,fe,5,1,"div",6),b.Lb(),b.Jb(),b.Lb()),2&t){const t=b.hc(4);b.xb(2),b.cc("ngIf",!e.showSettings)("ngIfElse",t),b.xb(3),b.cc("ngIf",e.loading),b.xb(3),b.cc("ngForOf",e.folders),b.xb(1),b.cc("ngIf",e.imageFile)}},directives:[D,i.l,i.k,i.j,Zt,se,ae],encapsulation:2}),t})();const ge=t=>e=>be(e,t);function be(t,e){t.selected=e,t.isDirectory&&t.entries.forEach(t=>be(t,e))}var me=n("itXk"),Ae=n("WiYX");let _e=(()=>{class t{constructor(t,e){this.photoService=t,this.queue=e,this.chunkSize=5,this.uploading=!1,this.status$=new m.a({uploading:!1}),e.get().subscribe(t=>this.items=t.slice())}status(){return this.status$.asObservable()}start(){return Object(s.b)(this,void 0,void 0,(function*(){this.uploading=!0;let t=this.getNextChunk();for(;this.uploading;){const e=yield t;if(!e.length){this.pause();break}t=this.getNextChunk();const n=[];for(const t of e){if(!this.uploading)break;const e=yield this.upload(t);n.push(e)}const i=e[0].item.settings.albumId;n.length&&(yield this.photoService.createMediaItems(n,i),e.forEach(t=>t.item.status="done"),this.queue.save())}this.queue.save()}))}getNextChunk(){const t=this.items.filter(t=>"pending"===t.status);if(!t.length)return Promise.resolve([]);const e=t[0].settings.albumId;return function(t){return Object(s.b)(this,void 0,void 0,(function*(){t.forEach(t=>t.status="resizing");const e=function(t){const e=new Ae,n=[];e.after("_calculate_size",t=>{const e=t.opts.result;return e.originalWidth=t.image.width,e.originalHeight=t.image.height,e.width=t.transform_width,e.height=t.transform_height,t});for(const i of t){const t={original:i.file};n.push(new Promise(n=>Object(s.b)(this,void 0,void 0,(function*(){t.resized=yield e.toBlob(i.file,{max:i.maxSize,result:t}),n(t)}))))}return n}(yield Promise.all(t.map(t=>Object(s.b)(this,void 0,void 0,(function*(){return{file:yield f(t.entry),maxSize:t.settings.maxSize}}))))).map((e,n)=>e.then(e=>{const i=t[n];return i.uploadSize=e.resized.size,i.originalDimensions=`${e.originalWidth}x${e.originalHeight}`,i.uploadDimensions=`${e.width}x${e.height}`,e.resized}));return t.map((t,n)=>({item:t,file:e[n]}))}))}(t.filter(t=>t.settings.albumId===e).slice(0,this.chunkSize))}upload(t){return Object(s.b)(this,void 0,void 0,(function*(){const e=t.item;e.status="uploading",this.status$.next({currentItem:e,uploading:!0});const n=t.item.name,i=yield t.file;t.file=null;const{uploadToken:r}=yield this.photoService.uploadImage(i,n,e=>t.item.progress=100*e);return{fileName:n,uploadToken:r}}))}pause(){this.uploading=!1,this.status$.next({currentItem:this.currentItem,uploading:!1})}}return t.\u0275fac=function(e){return new(e||t)(b.Qb(L),b.Qb(C))},t.\u0275prov=b.Db({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var ve=n("N7ed");function ye(t,e){if(1&t&&(b.Kb(0),b.oc(1),b.Xb(2,"number"),b.Jb()),2&t){const t=b.Wb().$implicit;b.xb(1),b.qc(" ",b.Zb(2,1,t.progress,"1.0-0")," % ")}}function we(t,e){1&t&&(b.Kb(0),b.oc(1," \u2713 "),b.Jb())}function Ce(t,e){1&t&&(b.Kb(0),b.oc(1," \u29d6 "),b.Jb())}function Ie(t,e){if(1&t&&(b.Mb(0,"div",7),b.Mb(1,"div"),b.oc(2),b.Lb(),b.Mb(3,"div"),b.oc(4),b.Lb(),b.Mb(5,"div"),b.oc(6),b.Lb(),b.Mb(7,"div"),b.oc(8),b.Xb(9,"bytes"),b.Xb(10,"bytes"),b.Lb(),b.Mb(11,"div",8),b.mc(12,ye,3,4,"ng-container",9),b.mc(13,we,2,0,"ng-container",9),b.mc(14,Ce,2,0,"ng-container",9),b.Lb(),b.Lb()),2&t){const t=e.$implicit;b.xb(2),b.pc(t.name),b.xb(2),b.pc(t.settings.albumName),b.xb(2),b.rc(" ",t.originalDimensions," / ",t.uploadDimensions," "),b.xb(2),b.rc(" ",b.Zb(9,10,t.size,"MB")," / ",b.Zb(10,13,t.uploadSize,"MB")," "),b.xb(3),b.cc("ngSwitch",t.status),b.xb(1),b.cc("ngSwitchCase","uploading"),b.xb(1),b.cc("ngSwitchCase","done"),b.xb(1),b.cc("ngSwitchCase","resizing")}}const Ee=[{path:"",component:pe},{path:"queue",component:(()=>{class t{constructor(t,e){this.queue=t,this.upload=e,this.unsubscribe$=new o.a}ngOnInit(){this.items$=this.queue.get(),this.uploadStatus$=this.upload.status(),Object(me.a)([this.items$,this.uploadStatus$]).pipe(l(this.unsubscribe$)).subscribe(t=>{const e=t[0],n=e.filter(t=>!t.progress);this.pendingFiles=n.length,this.totalFiles=e.length})}ngOnDestroy(){this.unsubscribe$.next(),this.unsubscribe$.complete()}start(){this.upload.start()}pause(){this.upload.pause()}clear(){this.queue.clear()}}return t.\u0275fac=function(e){return new(e||t)(b.Hb(C),b.Hb(_e))},t.\u0275cmp=b.Bb({type:t,selectors:[["app-upload-queue"]],decls:27,vars:14,consts:[["content",""],[1,"d-flex","mb-3"],["type","button",1,"btn","btn-outline-primary","mr-2",3,"disabled","click"],[1,"flex-fill"],[1,"app-queue","my-3"],[1,"app-queue-item"],["class","",4,"ngFor","ngForOf"],[1,""],[3,"ngSwitch"],[4,"ngSwitchCase"]],template:function(t,e){var n,i,r;1&t&&(b.Mb(0,"app-upload-layout"),b.Kb(1,0),b.Mb(2,"div",1),b.Mb(3,"button",2),b.Tb("click",(function(){return e.start()})),b.Xb(4,"async"),b.oc(5," Start upload "),b.Lb(),b.Mb(6,"button",2),b.Tb("click",(function(){return e.pause()})),b.Xb(7,"async"),b.oc(8," Pause upload "),b.Lb(),b.Ib(9,"div",3),b.Mb(10,"button",2),b.Tb("click",(function(){return e.clear()})),b.Xb(11,"async"),b.oc(12," Clear queue "),b.Lb(),b.Lb(),b.Mb(13,"div",4),b.Mb(14,"div",5),b.Mb(15,"div"),b.Mb(16,"strong"),b.oc(17),b.Lb(),b.oc(18," / "),b.Mb(19,"strong"),b.oc(20),b.Lb(),b.Lb(),b.Ib(21,"div"),b.Ib(22,"div"),b.Ib(23,"div"),b.Ib(24,"div"),b.Lb(),b.mc(25,Ie,15,16,"div",6),b.Xb(26,"async"),b.Lb(),b.Jb(),b.Lb()),2&t&&(b.xb(3),b.cc("disabled",null==(n=b.Yb(4,6,e.uploadStatus$))?null:n.uploading),b.xb(3),b.cc("disabled",!(null!=(i=b.Yb(7,8,e.uploadStatus$))&&i.uploading)),b.xb(4),b.cc("disabled",null==(r=b.Yb(11,10,e.uploadStatus$))?null:r.uploading),b.xb(7),b.qc("",e.totalFiles," "),b.xb(3),b.qc("",e.pendingFiles," files"),b.xb(5),b.cc("ngForOf",b.Yb(26,12,e.items$)))},directives:[D,i.k,i.m,i.n],pipes:[i.b,ve.a,i.e],encapsulation:2}),t})()}];let xe=(()=>{class t{}return t.\u0275mod=b.Fb({type:t}),t.\u0275inj=b.Eb({factory:function(e){return new(e||t)},imports:[[r.c.forChild(Ee)],r.c]}),t})();var Be=n("PCNd");let Oe=(()=>{class t{}return t.\u0275mod=b.Fb({type:t}),t.\u0275inj=b.Eb({factory:function(e){return new(e||t)},imports:[[i.c,Ht,Be.a,xe]]}),t})()},K0AA:function(t,e,n){"use strict";function i(t,e){var n={};return e.forEach((function(e){Object.prototype.hasOwnProperty.call(t,e)&&(n[e]=t[e])})),n}t.exports.assign=function(t){for(var e,n=1;n<arguments.length;n++)for(var i in e=Object(arguments[n]))Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t},t.exports.pick=i,t.exports.pick_pica_resize_options=function(t){return i(t,["alpha","unsharpAmount","unsharpRadius","unsharpThreshold","cancelToken"])}},U8xv:function(t,e,n){"use strict";function i(t,e){var n=new Error(t);return n.code=e,n}function r(t){for(var e=t.toString(16).toUpperCase(),n=2-e.length;n>0;n--)e="0"+e;return"0x"+e}function s(t){try{return decodeURIComponent(escape(t))}catch(e){return t}}function o(t){return"[object Uint8Array]"===Object.prototype.toString.call(t)}function a(t,e,n){this.input=t.subarray(e,n),this.start=e;var r=String.fromCharCode.apply(null,this.input.subarray(0,4));if("II*\0"!==r&&"MM\0*"!==r)throw i("invalid TIFF signature","EBADDATA");this.big_endian="M"===r[0]}a.prototype.each=function(t){this.aborted=!1;var e=this.read_uint32(4);for(this.ifds_to_read=[{id:0,offset:e}];this.ifds_to_read.length>0&&!this.aborted;){var n=this.ifds_to_read.shift();n.offset&&this.scan_ifd(n.id,n.offset,t)}},a.prototype.filter=function(t){var e={ifd0:{id:0,entries:[]}};this.each((function(n){(!1!==t(n)||n.is_subifd_link)&&(n.is_subifd_link&&1!==n.count&&4!==n.format||(e["ifd"+n.ifd]||(e["ifd"+n.ifd]={id:n.ifd,entries:[]}),e["ifd"+n.ifd].entries.push(n)))})),delete e.ifd1;var n=8;Object.keys(e).forEach((function(t){n+=2,e[t].entries.forEach((function(t){n+=12+(t.data_length>4?2*Math.ceil(t.data_length/2):0)})),n+=4})),this.output=new Uint8Array(n),this.output[0]=this.output[1]=(this.big_endian?"M":"I").charCodeAt(0),this.write_uint16(2,42);var r=8,s=this;if(this.write_uint32(4,r),Object.keys(e).forEach((function(t){e[t].written_offset=r;var n=r,i=n+2+12*e[t].entries.length+4;r=i,s.write_uint16(n,e[t].entries.length),e[t].entries.sort((function(t,e){return t.tag-e.tag})).forEach((function(t,i){var o=n+2+12*i;s.write_uint16(o,t.tag),s.write_uint16(o+2,t.format),s.write_uint32(o+4,t.count),t.is_subifd_link?e["ifd"+t.tag]&&(e["ifd"+t.tag].link_offset=o+8):t.data_length<=4?s.output.set(s.input.subarray(t.data_offset-s.start,t.data_offset-s.start+4),o+8):(s.write_uint32(o+8,r),s.output.set(s.input.subarray(t.data_offset-s.start,t.data_offset-s.start+t.data_length),r),r+=2*Math.ceil(t.data_length/2))}));var o=e["ifd"+(e[t].id+1)];o&&(o.link_offset=i-4)})),Object.keys(e).forEach((function(t){e[t].written_offset&&e[t].link_offset&&s.write_uint32(e[t].link_offset,e[t].written_offset)})),this.output.length!==r)throw i("internal error: incorrect buffer size allocated");return this.output},a.prototype.read_uint16=function(t){var e=this.input;if(t+2>e.length)throw i("unexpected EOF","EBADDATA");return this.big_endian?256*e[t]+e[t+1]:e[t]+256*e[t+1]},a.prototype.read_uint32=function(t){var e=this.input;if(t+4>e.length)throw i("unexpected EOF","EBADDATA");return this.big_endian?16777216*e[t]+65536*e[t+1]+256*e[t+2]+e[t+3]:e[t]+256*e[t+1]+65536*e[t+2]+16777216*e[t+3]},a.prototype.write_uint16=function(t,e){var n=this.output;this.big_endian?(n[t]=e>>>8&255,n[t+1]=255&e):(n[t]=255&e,n[t+1]=e>>>8&255)},a.prototype.write_uint32=function(t,e){var n=this.output;this.big_endian?(n[t]=e>>>24&255,n[t+1]=e>>>16&255,n[t+2]=e>>>8&255,n[t+3]=255&e):(n[t]=255&e,n[t+1]=e>>>8&255,n[t+2]=e>>>16&255,n[t+3]=e>>>24&255)},a.prototype.is_subifd_link=function(t,e){return 0===t&&34665===e||0===t&&34853===e||34665===t&&40965===e},a.prototype.exif_format_length=function(t){switch(t){case 1:case 2:case 6:case 7:return 1;case 3:case 8:return 2;case 4:case 9:case 11:return 4;case 5:case 10:case 12:return 8;default:return 0}},a.prototype.exif_format_read=function(t,e){var n;switch(t){case 1:case 2:return this.input[e];case 6:return(n=this.input[e])|33554430*(128&n);case 3:return this.read_uint16(e);case 8:return(n=this.read_uint16(e))|131070*(32768&n);case 4:return this.read_uint32(e);case 9:return 0|this.read_uint32(e);case 5:case 10:case 11:case 12:case 7:default:return null}},a.prototype.scan_ifd=function(t,e,n){var r=this.read_uint16(e);e+=2;for(var o=0;o<r;o++){var a=this.read_uint16(e),l=this.read_uint16(e+2),u=this.read_uint32(e+4),c=this.exif_format_length(l),h=u*c,d=h<=4?e+8:this.read_uint32(e+8),f=!1;if(d+h>this.input.length)throw i("unexpected EOF","EBADDATA");for(var p=[],g=d,b=0;b<u;b++,g+=c){var m=this.exif_format_read(l,g);if(null===m){p=null;break}p.push(m)}if(Array.isArray(p)&&2===l){try{p=s(String.fromCharCode.apply(null,p))}catch(A){p=null}p&&"\0"===p[p.length-1]&&(p=p.slice(0,-1))}if(this.is_subifd_link(t,a)&&Array.isArray(p)&&Number.isInteger(p[0])&&p[0]>0&&(this.ifds_to_read.push({id:a,offset:p[0]}),f=!0),!1===n({is_big_endian:this.big_endian,ifd:t,tag:a,format:l,count:u,entry_offset:e+this.start,data_length:h,data_offset:d+this.start,value:p,is_subifd_link:f}))return void(this.aborted=!0);e+=12}0===t&&this.ifds_to_read.push({id:1,offset:this.read_uint32(e)})},t.exports.is_jpeg=function(t){return t.length>=4&&255===t[0]&&216===t[1]&&255===t[2]},t.exports.jpeg_segments_each=function(e,n){if(!o(e))throw i("Invalid argument (jpeg_bin), Uint8Array expected","EINVAL");if("function"!=typeof n)throw i("Invalid argument (on_segment), Function expected","EINVAL");if(!t.exports.is_jpeg(e))throw i("Unknown file format","ENOTJPEG");for(var s=0,a=e.length,l=!1;;){var u,c;if(s+1>=a)throw i("Unexpected EOF","EBADDATA");var h=e[s],d=e[s+1];if(255===h&&255===d)u=255,c=1;else if(255===h&&0!==d){if(c=2,208<=(u=d)&&u<=217||1===u);else{if(s+3>=a)throw i("Unexpected EOF","EBADDATA");if((c+=256*e[s+2]+e[s+3])<2)throw i("Invalid segment length","EBADDATA");if(s+c-1>=a)throw i("Unexpected EOF","EBADDATA")}l&&(u>=208&&u<=215||(l=!1)),218===u&&(l=!0)}else{if(!l)throw i("Unexpected byte at segment start: "+r(h)+" (offset "+r(s)+")","EBADDATA");for(var f=s+1;;f++){if(f>=a)throw i("Unexpected EOF","EBADDATA");if(255===e[f]){if(f+1>=a)throw i("Unexpected EOF","EBADDATA");if(0!==e[f+1]){u=0,c=f-s;break}}}}if(!1===n({code:u,offset:s,length:c}))break;if(217===u)break;s+=c}},t.exports.jpeg_segments_filter=function(e,n){if(!o(e))throw i("Invalid argument (jpeg_bin), Uint8Array expected","EINVAL");if("function"!=typeof n)throw i("Invalid argument (on_segment), Function expected","EINVAL");var r=[],s=0;t.exports.jpeg_segments_each(e,(function(t){var e=n(t);if(o(e))r.push({data:e}),s+=e.length;else if(Array.isArray(e))e.filter(o).forEach((function(t){r.push({data:t}),s+=t.length}));else if(!1!==e){var i={start:t.offset,end:t.offset+t.length};r.length>0&&r[r.length-1].end===i.start?r[r.length-1].end=i.end:r.push(i),s+=t.length}}));var a=new Uint8Array(s),l=0;return r.forEach((function(t){var n=t.data||e.subarray(t.start,t.end);a.set(n,l),l+=n.length})),a},t.exports.jpeg_exif_tags_each=function(e,n){if(!o(e))throw i("Invalid argument (jpeg_bin), Uint8Array expected","EINVAL");if("function"!=typeof n)throw i("Invalid argument (on_exif_entry), Function expected","EINVAL");t.exports.jpeg_segments_each(e,(function(t){return 218!==t.code&&(225===t.code&&t.length>=10&&69===e[t.offset+4]&&120===e[t.offset+5]&&105===e[t.offset+6]&&102===e[t.offset+7]&&0===e[t.offset+8]&&0===e[t.offset+9]?(new a(e,t.offset+10,t.offset+t.length).each(n),!1):void 0)}))},t.exports.jpeg_exif_tags_filter=function(e,n){if(!o(e))throw i("Invalid argument (jpeg_bin), Uint8Array expected","EINVAL");if("function"!=typeof n)throw i("Invalid argument (on_exif_entry), Function expected","EINVAL");var r=!1;return t.exports.jpeg_segments_filter(e,(function(t){if(!r&&(218===t.code&&(r=!0),225===t.code&&t.length>=10&&69===e[t.offset+4]&&120===e[t.offset+5]&&105===e[t.offset+6]&&102===e[t.offset+7]&&0===e[t.offset+8]&&0===e[t.offset+9])){var i=new a(e,t.offset+10,t.offset+t.length).filter(n);if(!i)return!1;var s=new Uint8Array(10);return s.set(e.slice(t.offset,t.offset+10)),s[2]=i.length+8>>>8&255,s[3]=i.length+8&255,r=!0,[s,i]}}))},t.exports.jpeg_add_comment=function(e,n){var i=!1,r=0;return t.exports.jpeg_segments_filter(e,(function(t){if(!(1==++r&&216===t.code||2===r&&224===t.code||i)){n=function(t){try{return unescape(encodeURIComponent(t))}catch(e){return t}}(n);var s=new Uint8Array(5+n.length),o=0;return s[o++]=255,s[o++]=254,s[o++]=n.length+3>>>8&255,s[o++]=n.length+3&255,n.split("").forEach((function(t){s[o++]=255&t.charCodeAt(0)})),s[o++]=0,i=!0,[s,e.subarray(t.offset,t.offset+t.length)]}}))}},WiYX:function(t,e,n){"use strict";var i=n("K0AA");function r(t){if(!(this instanceof r))return new r(t);this.pica=(t=t||{}).pica||n("gkvR")(),this.initialized=!1,this.utils=i}r.prototype.use=function(t){var e=[this].concat(Array.prototype.slice.call(arguments,1));return t.apply(t,e),this},r.prototype.init=function(){this.use(n("dQ24").assign)},r.prototype.toBlob=function(t,e){var n={blob:t,opts:i.assign({max:1/0},e)};return this.initialized||(this.init(),this.initialized=!0),Promise.resolve(n).then(this._blob_to_image).then(this._calculate_size).then(this._transform).then(this._cleanup).then(this._create_blob).then((function(t){return t.out_canvas.width=t.out_canvas.height=0,t.out_blob}))},r.prototype.toCanvas=function(t,e){var n={blob:t,opts:i.assign({max:1/0},e)};return this.initialized||(this.init(),this.initialized=!0),Promise.resolve(n).then(this._blob_to_image).then(this._calculate_size).then(this._transform).then(this._cleanup).then((function(t){return t.out_canvas}))},r.prototype.before=function(t,e){if(!this[t])throw new Error('Method "'+t+'" does not exist');if("function"!=typeof e)throw new Error('Invalid argument "fn", function expected');var n=this[t],i=this;return this[t]=function(t){return e.call(i,t).then((function(t){return n.call(i,t)}))},this},r.prototype.after=function(t,e){if(!this[t])throw new Error('Method "'+t+'" does not exist');if("function"!=typeof e)throw new Error('Invalid argument "fn", function expected');var n=this[t],i=this;return this[t]=function(t){return n.call(i,t).then((function(t){return e.call(i,t)}))},this},r.prototype._blob_to_image=function(t){var e=window.URL||window.webkitURL||window.mozURL||window.msURL;return t.image=document.createElement("img"),t.image_url=e.createObjectURL(t.blob),t.image.src=t.image_url,new Promise((function(e,n){t.image.onerror=function(){n(new Error("ImageBlobReduce: failed to create Image() from blob"))},t.image.onload=function(){e(t)}}))},r.prototype._calculate_size=function(t){var e=t.opts.max/Math.max(t.image.width,t.image.height);return e>1&&(e=1),t.transform_width=Math.max(Math.round(t.image.width*e),1),t.transform_height=Math.max(Math.round(t.image.height*e),1),t.scale_factor=e,Promise.resolve(t)},r.prototype._transform=function(t){t.out_canvas=this.pica.options.createCanvas(t.transform_width,t.transform_height),t.transform_width=null,t.transform_height=null;var e={alpha:"image/png"===t.blob.type};return this.utils.assign(e,this.utils.pick_pica_resize_options(t.opts)),this.pica.resize(t.image,t.out_canvas,e).then((function(){return t}))},r.prototype._cleanup=function(t){t.image.src="",t.image=null;var e=window.URL||window.webkitURL||window.mozURL||window.msURL;return e.revokeObjectURL&&e.revokeObjectURL(t.image_url),t.image_url=null,Promise.resolve(t)},r.prototype._create_blob=function(t){return this.pica.toBlob(t.out_canvas,t.blob.type).then((function(e){return t.out_blob=e,t}))},r.prototype._getUint8Array=function(t){return t.arrayBuffer?t.arrayBuffer().then((function(t){return new Uint8Array(t)})):new Promise((function(e,n){var i=new FileReader;i.readAsArrayBuffer(t),i.onload=function(){e(new Uint8Array(i.result))},i.onerror=function(){n(new Error("ImageBlobReduce: failed to load data from input blob")),i.abort()},i.onabort=function(){n(new Error("ImageBlobReduce: failed to load data from input blob (aborted)"))}}))},r.pica=n("gkvR"),t.exports=r},dQ24:function(t,e,n){"use strict";var i=n("U8xv");function r(t){return this._getUint8Array(t.blob).then((function(e){if(t.is_jpeg=i.is_jpeg(e),!t.is_jpeg)return Promise.resolve(t);t.orig_blob=t.blob;try{var n,r;if(i.jpeg_exif_tags_each(e,(function(e){if(0===e.ifd&&274===e.tag&&Array.isArray(e.value))return t.orientation=e.value[0]||1,n=e.big_endian,r=e.data_offset,!1})),r){var s=n?new Uint8Array([0,1]):new Uint8Array([1,0]);t.blob=new Blob([e.slice(0,r),s,e.slice(r+2)],{type:"image/jpeg"})}}catch(o){}return t}))}function s(t){if(!t.is_jpeg)return Promise.resolve(t);var e,n=t.orientation-1;if(!n)return Promise.resolve(t);var i=(e=4&n?this.pica.options.createCanvas(t.out_canvas.height,t.out_canvas.width):this.pica.options.createCanvas(t.out_canvas.width,t.out_canvas.height)).getContext("2d");return i.save(),1&n&&i.transform(-1,0,0,1,e.width,0),2&n&&i.transform(-1,0,0,-1,e.width,e.height),4&n&&i.transform(0,1,1,0,0,0),i.drawImage(t.out_canvas,0,0),i.restore(),t.out_canvas.width=t.out_canvas.height=0,t.out_canvas=e,Promise.resolve(t)}function o(t){return t.is_jpeg?Promise.all([this._getUint8Array(t.blob),this._getUint8Array(t.out_blob)]).then((function(e){var n=e[0];if(i.is_jpeg(e[1]))return Promise.resolve(t);var r=[];return i.jpeg_segments_each(n,(function(t){if(218===t.code)return!1;r.push(t)})),r=r.filter((function(t){if(226===t.code){var e=n.slice(t.offset+4,t.offset+11);if("ICC_PROFILE"===String.fromCharCode.apply(e))return!1}return t.code>=224&&t.code<240||254===t.code})).map((function(t){return n.slice(t.offset,t.offset+t.length)})),t.blob=new Blob([n.slice(0,20)].concat(r).concat([n.slice(20)]),{type:"image/jpeg"}),t})):Promise.resolve(t)}t.exports.jpeg_patch_exif=r,t.exports.jpeg_rotate_canvas=s,t.exports.jpeg_attach_orig_segments=o,t.exports.assign=function(t){t.before("_blob_to_image",r),t.after("_transform",s),t.after("_create_blob",o)}},gkvR:function(t,e,n){t.exports=function t(e,n,i){function r(o,a){if(!n[o]){if(!e[o]){if(s)return s(o,!0);var l=new Error("Cannot find module '"+o+"'");throw l.code="MODULE_NOT_FOUND",l}var u=n[o]={exports:{}};e[o][0].call(u.exports,(function(t){return r(e[o][1][t]||t)}),u,u.exports,t,e,n,i)}return n[o].exports}for(var s=!1,o=0;o<i.length;o++)r(i[o]);return r}({1:[function(t,e,n){"use strict";var i=t("inherits"),r=t("multimath"),s=t("multimath/lib/unsharp_mask"),o=t("./mm_resize");function a(t){var e=t||[],n={js:e.indexOf("js")>=0,wasm:e.indexOf("wasm")>=0};r.call(this,n),this.features={js:n.js,wasm:n.wasm&&this.has_wasm()},this.use(s),this.use(o)}i(a,r),a.prototype.resizeAndUnsharp=function(t,e){var n=this.resize(t,e);return t.unsharpAmount&&this.unsharp_mask(n,t.toWidth,t.toHeight,t.unsharpAmount,t.unsharpRadius,t.unsharpThreshold),n},e.exports=a},{"./mm_resize":4,inherits:15,multimath:16,"multimath/lib/unsharp_mask":19}],2:[function(t,e,n){"use strict";function i(t){return t<0?0:t>255?255:t}e.exports={convolveHorizontally:function(t,e,n,r,s,o){var a,l,u,c,h,d,f,p,g,b,m,A=0,_=0;for(g=0;g<r;g++){for(h=0,b=0;b<s;b++){for(d=o[h++],f=o[h++],p=A+4*d|0,a=l=u=c=0;f>0;f--)c=c+(m=o[h++])*t[p+3]|0,u=u+m*t[p+2]|0,l=l+m*t[p+1]|0,a=a+m*t[p]|0,p=p+4|0;e[_+3]=i(c+8192>>14),e[_+2]=i(u+8192>>14),e[_+1]=i(l+8192>>14),e[_]=i(a+8192>>14),_=_+4*r|0}_=4*(g+1)|0,A=(g+1)*n*4|0}},convolveVertically:function(t,e,n,r,s,o){var a,l,u,c,h,d,f,p,g,b,m,A=0,_=0;for(g=0;g<r;g++){for(h=0,b=0;b<s;b++){for(d=o[h++],f=o[h++],p=A+4*d|0,a=l=u=c=0;f>0;f--)c=c+(m=o[h++])*t[p+3]|0,u=u+m*t[p+2]|0,l=l+m*t[p+1]|0,a=a+m*t[p]|0,p=p+4|0;e[_+3]=i(c+8192>>14),e[_+2]=i(u+8192>>14),e[_+1]=i(l+8192>>14),e[_]=i(a+8192>>14),_=_+4*r|0}_=4*(g+1)|0,A=(g+1)*n*4|0}}}},{}],3:[function(t,e,n){"use strict";e.exports="AGFzbQEAAAABFAJgBn9/f39/fwBgB39/f39/f38AAg8BA2VudgZtZW1vcnkCAAEDAwIAAQQEAXAAAAcZAghjb252b2x2ZQAACmNvbnZvbHZlSFYAAQkBAArmAwLBAwEQfwJAIANFDQAgBEUNACAFQQRqIRVBACEMQQAhDQNAIA0hDkEAIRFBACEHA0AgB0ECaiESAn8gBSAHQQF0IgdqIgZBAmouAQAiEwRAQQAhCEEAIBNrIRQgFSAHaiEPIAAgDCAGLgEAakECdGohEEEAIQlBACEKQQAhCwNAIBAoAgAiB0EYdiAPLgEAIgZsIAtqIQsgB0H/AXEgBmwgCGohCCAHQRB2Qf8BcSAGbCAKaiEKIAdBCHZB/wFxIAZsIAlqIQkgD0ECaiEPIBBBBGohECAUQQFqIhQNAAsgEiATagwBC0EAIQtBACEKQQAhCUEAIQggEgshByABIA5BAnRqIApBgMAAakEOdSIGQf8BIAZB/wFIG0EQdEGAgPwHcUEAIAZBAEobIAtBgMAAakEOdSIGQf8BIAZB/wFIG0EYdEEAIAZBAEobciAJQYDAAGpBDnUiBkH/ASAGQf8BSBtBCHRBgP4DcUEAIAZBAEobciAIQYDAAGpBDnUiBkH/ASAGQf8BSBtB/wFxQQAgBkEAShtyNgIAIA4gA2ohDiARQQFqIhEgBEcNAAsgDCACaiEMIA1BAWoiDSADRw0ACwsLIQACQEEAIAIgAyAEIAUgABAAIAJBACAEIAUgBiABEAALCw=="},{}],4:[function(t,e,n){"use strict";e.exports={name:"resize",fn:t("./resize"),wasm_fn:t("./resize_wasm"),wasm_src:t("./convolve_wasm_base64")}},{"./convolve_wasm_base64":3,"./resize":5,"./resize_wasm":8}],5:[function(t,e,n){"use strict";var i=t("./resize_filter_gen"),r=t("./convolve").convolveHorizontally,s=t("./convolve").convolveVertically;e.exports=function(t){var e=t.src,n=t.width,o=t.height,a=t.toWidth,l=t.toHeight,u=t.scaleX||t.toWidth/t.width,c=t.scaleY||t.toHeight/t.height,h=t.offsetX||0,d=t.offsetY||0,f=t.dest||new Uint8Array(a*l*4),p=void 0===t.quality?3:t.quality,g=t.alpha||!1,b=i(p,n,a,u,h),m=i(p,o,l,c,d),A=new Uint8Array(a*o*4);return r(e,A,n,o,a,b),s(A,f,o,a,l,m),g||function(t,e,n){for(var i=3,r=e*n*4|0;i<r;)t[i]=255,i=i+4|0}(f,a,l),f}},{"./convolve":2,"./resize_filter_gen":6}],6:[function(t,e,n){"use strict";var i=t("./resize_filter_info");function r(t){return Math.round(16383*t)}e.exports=function(t,e,n,s,o){var a,l,u,c,h,d,f,p,g,b,m,A,_,v,y,w,C=i[t].filter,I=1/s,E=Math.min(1,s),x=i[t].win/E,B=Math.floor(2*(x+1)),O=new Int16Array((B+2)*n),M=0,k=!O.subarray||!O.set;for(a=0;a<n;a++){for(l=(a+.5)*I+o,u=Math.max(0,Math.floor(l-x)),h=(c=Math.min(e-1,Math.ceil(l+x)))-u+1,d=new Float32Array(h),f=new Int16Array(h),p=0,g=u,b=0;g<=c;g++,b++)p+=m=C((g+.5-l)*E),d[b]=m;for(A=0,b=0;b<d.length;b++)A+=_=d[b]/p,f[b]=r(_);for(f[n>>1]+=r(1-A),v=0;v<f.length&&0===f[v];)v++;if(v<f.length){for(y=f.length-1;y>0&&0===f[y];)y--;if(w=y-v+1,O[M++]=u+v,O[M++]=w,k)for(b=v;b<=y;b++)O[M++]=f[b];else O.set(f.subarray(v,y+1),M),M+=w}else O[M++]=0,O[M++]=0}return O}},{"./resize_filter_info":7}],7:[function(t,e,n){"use strict";e.exports=[{win:.5,filter:function(t){return t>=-.5&&t<.5?1:0}},{win:1,filter:function(t){if(t<=-1||t>=1)return 0;if(t>-1.1920929e-7&&t<1.1920929e-7)return 1;var e=t*Math.PI;return Math.sin(e)/e*(.54+.46*Math.cos(e/1))}},{win:2,filter:function(t){if(t<=-2||t>=2)return 0;if(t>-1.1920929e-7&&t<1.1920929e-7)return 1;var e=t*Math.PI;return Math.sin(e)/e*Math.sin(e/2)/(e/2)}},{win:3,filter:function(t){if(t<=-3||t>=3)return 0;if(t>-1.1920929e-7&&t<1.1920929e-7)return 1;var e=t*Math.PI;return Math.sin(e)/e*Math.sin(e/3)/(e/3)}}]},{}],8:[function(t,e,n){"use strict";var i=t("./resize_filter_gen"),r=!0;try{r=1===new Uint32Array(new Uint8Array([1,0,0,0]).buffer)[0]}catch(o){}function s(t,e,n){if(r)e.set(function(t){return new Uint8Array(t.buffer,0,t.byteLength)}(t),n);else for(var i=n,s=0;s<t.length;s++){var o=t[s];e[i++]=255&o,e[i++]=o>>8&255}}e.exports=function(t){var e=t.src,n=t.width,r=t.height,o=t.toWidth,a=t.toHeight,l=t.scaleX||t.toWidth/t.width,u=t.scaleY||t.toHeight/t.height,c=t.offsetX||0,h=t.offsetY||0,d=t.dest||new Uint8Array(o*a*4),f=void 0===t.quality?3:t.quality,p=t.alpha||!1,g=i(f,n,o,l,c),b=i(f,r,a,u,h),m=this.__align(0+Math.max(e.byteLength,d.byteLength)),A=this.__align(m+r*o*4),_=this.__align(A+g.byteLength),v=this.__instance("resize",_+b.byteLength),y=new Uint8Array(this.__memory.buffer),w=new Uint32Array(this.__memory.buffer),C=new Uint32Array(e.buffer);return w.set(C),s(g,y,A),s(b,y,_),(v.exports.convolveHV||v.exports._convolveHV)(A,_,m,n,r,o,a),new Uint32Array(d.buffer).set(new Uint32Array(this.__memory.buffer,0,a*o)),p||function(t,e,n){for(var i=3,r=e*n*4|0;i<r;)t[i]=255,i=i+4|0}(d,o,a),d}},{"./resize_filter_gen":6}],9:[function(t,e,n){"use strict";function i(t,e){this.create=t,this.available=[],this.acquired={},this.lastId=1,this.timeoutId=0,this.idle=e||2e3}i.prototype.acquire=function(){var t,e=this;return 0!==this.available.length?t=this.available.pop():((t=this.create()).id=this.lastId++,t.release=function(){return e.release(t)}),this.acquired[t.id]=t,t},i.prototype.release=function(t){var e=this;delete this.acquired[t.id],t.lastUsed=Date.now(),this.available.push(t),0===this.timeoutId&&(this.timeoutId=setTimeout((function(){return e.gc()}),100))},i.prototype.gc=function(){var t=this,e=Date.now();this.available=this.available.filter((function(n){return!(e-n.lastUsed>t.idle&&(n.destroy(),1))})),this.timeoutId=0!==this.available.length?setTimeout((function(){return t.gc()}),100):0},e.exports=i},{}],10:[function(t,e,n){"use strict";e.exports=function(t,e,n,i,r,s){var o=(2*s+2+1)/r;if(o>.5)return[[n,i]];var a=Math.ceil(Math.log(Math.min(n/t,i/e))/Math.log(o));if(a<=1)return[[n,i]];for(var l=[],u=0;u<a;u++){var c=Math.round(Math.pow(Math.pow(t,a-u-1)*Math.pow(n,u+1),1/a)),h=Math.round(Math.pow(Math.pow(e,a-u-1)*Math.pow(i,u+1),1/a));l.push([c,h])}return l}},{}],11:[function(t,e,n){"use strict";var i=1e-5;function r(t){var e=Math.round(t);return Math.abs(t-e)<i?e:Math.floor(t)}function s(t){var e=Math.round(t);return Math.abs(t-e)<i?e:Math.ceil(t)}e.exports=function(t){var e,n,i,o,a,l,u=t.toWidth/t.width,c=t.toHeight/t.height,h=r(t.srcTileSize*u)-2*t.destTileBorder,d=r(t.srcTileSize*c)-2*t.destTileBorder;if(h<1||d<1)throw new Error("Internal error in pica: target tile width/height is too small.");var f,p=[];for(o=0;o<t.toHeight;o+=d)for(i=0;i<t.toWidth;i+=h)(e=i-t.destTileBorder)<0&&(e=0),e+(a=i+h+t.destTileBorder-e)>=t.toWidth&&(a=t.toWidth-e),(n=o-t.destTileBorder)<0&&(n=0),n+(l=o+d+t.destTileBorder-n)>=t.toHeight&&(l=t.toHeight-n),f={toX:e,toY:n,toWidth:a,toHeight:l,toInnerX:i,toInnerY:o,toInnerWidth:h,toInnerHeight:d,offsetX:e/u-r(e/u),offsetY:n/c-r(n/c),scaleX:u,scaleY:c,x:r(e/u),y:r(n/c),width:s(a/u),height:s(l/c)},p.push(f);return p}},{}],12:[function(t,e,n){"use strict";function i(t){return Object.prototype.toString.call(t)}e.exports.isCanvas=function(t){var e=i(t);return"[object HTMLCanvasElement]"===e||"[object OffscreenCanvas]"===e||"[object Canvas]"===e},e.exports.isImage=function(t){return"[object HTMLImageElement]"===i(t)},e.exports.isImageBitmap=function(t){return"[object ImageBitmap]"===i(t)},e.exports.limiter=function(t){var e=0,n=[];function i(){e<t&&n.length&&(e++,n.shift()())}return function(t){return new Promise((function(r,s){n.push((function(){t().then((function(t){r(t),e--,i()}),(function(t){s(t),e--,i()}))})),i()}))}},e.exports.cib_quality_name=function(t){switch(t){case 0:return"pixelated";case 1:return"low";case 2:return"medium"}return"high"},e.exports.cib_support=function(t){return Promise.resolve().then((function(){if("undefined"==typeof createImageBitmap)return!1;var e=t(100,100);return createImageBitmap(e,0,0,100,100,{resizeWidth:10,resizeHeight:10,resizeQuality:"high"}).then((function(t){var n=10===t.width;return t.close(),e=null,n}))})).catch((function(){return!1}))}},{}],13:[function(t,e,n){"use strict";e.exports=function(){var e,n=t("./mathlib");onmessage=function(t){var i=t.data.opts;e||(e=new n(t.data.features));var r=e.resizeAndUnsharp(i);postMessage({result:r},[r.buffer])}}},{"./mathlib":1}],14:[function(t,e,n){var i,r,s,o,a,l;function u(t,e,n,i,r,s){var o,a,l,u,c,h,d,f,p,g,b,m,A,_;for(p=0;p<s;p++){for(d=p,f=0,u=c=(o=t[h=p*r])*i[6],b=i[0],m=i[1],A=i[4],_=i[5],g=0;g<r;g++)l=(a=t[h])*b+o*m+u*A+c*_,c=u,o=a,n[f]=u=l,f++,h++;for(f--,d+=s*(r-1),u=c=(o=t[--h])*i[7],a=o,b=i[2],m=i[3],g=r-1;g>=0;g--)l=a*b+o*m+u*A+c*_,c=u,o=a,a=t[h],e[d]=n[f]+(u=l),h--,f--,d-=s}}e.exports=function(t,e,n,c){if(c){var h=new Uint16Array(t.length),d=new Float32Array(Math.max(e,n)),f=function(t){t<.5&&(t=.5);var e=Math.exp(.527076)/t,n=Math.exp(-e),u=Math.exp(-2*e),c=(1-n)*(1-n)/(1+2*e*n-u);return i=c,r=c*(e-1)*n,s=c*(e+1)*n,o=-c*u,a=2*n,l=-u,new Float32Array([i,r,s,o,a,l,(i+r)/(1-a-l),(s+o)/(1-a-l)])}(c);u(t,h,d,f,e,n),u(h,t,d,f,n,e)}}},{}],15:[function(t,e,n){e.exports="function"==typeof Object.create?function(t,e){e&&(t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}))}:function(t,e){if(e){t.super_=e;var n=function(){};n.prototype=e.prototype,t.prototype=new n,t.prototype.constructor=t}}},{}],16:[function(t,e,n){"use strict";var i=t("object-assign"),r=t("./lib/base64decode"),s=t("./lib/wa_detect"),o={js:!0,wasm:!0};function a(t){if(!(this instanceof a))return new a(t);var e=i({},o,t||{});if(this.options=e,this.__cache={},this.__init_promise=null,this.__modules=e.modules||{},this.__memory=null,this.__wasm={},this.__isLE=1===new Uint32Array(new Uint8Array([1,0,0,0]).buffer)[0],!this.options.js&&!this.options.wasm)throw new Error('mathlib: at least "js" or "wasm" should be enabled')}a.prototype.has_wasm=s,a.prototype.use=function(t){return this.__modules[t.name]=t,this[t.name]=this.options.wasm&&this.has_wasm()&&t.wasm_fn?t.wasm_fn:t.fn,this},a.prototype.init=function(){if(this.__init_promise)return this.__init_promise;if(!this.options.js&&this.options.wasm&&!this.has_wasm())return Promise.reject(new Error('mathlib: only "wasm" was enabled, but it\'s not supported'));var t=this;return this.__init_promise=Promise.all(Object.keys(t.__modules).map((function(e){var n=t.__modules[e];return t.options.wasm&&t.has_wasm()&&n.wasm_fn?t.__wasm[e]?null:WebAssembly.compile(t.__base64decode(n.wasm_src)).then((function(n){t.__wasm[e]=n})):null}))).then((function(){return t})),this.__init_promise},a.prototype.__base64decode=r,a.prototype.__reallocate=function(t){if(!this.__memory)return this.__memory=new WebAssembly.Memory({initial:Math.ceil(t/65536)}),this.__memory;var e=this.__memory.buffer.byteLength;return e<t&&this.__memory.grow(Math.ceil((t-e)/65536)),this.__memory},a.prototype.__instance=function(t,e,n){if(e&&this.__reallocate(e),this.__wasm[t]||(this.__wasm[t]=new WebAssembly.Module(this.__base64decode(this.__modules[t].wasm_src))),!this.__cache[t]){var r={memoryBase:0,memory:this.__memory,tableBase:0,table:new WebAssembly.Table({initial:0,element:"anyfunc"})};this.__cache[t]=new WebAssembly.Instance(this.__wasm[t],{env:i(r,n||{})})}return this.__cache[t]},a.prototype.__align=function(t,e){var n=t%(e=e||8);return t+(n?e-n:0)},e.exports=a},{"./lib/base64decode":17,"./lib/wa_detect":23,"object-assign":24}],17:[function(t,e,n){"use strict";e.exports=function(t){for(var e=t.replace(/[\r\n=]/g,""),n=e.length,i=new Uint8Array(3*n>>2),r=0,s=0,o=0;o<n;o++)o%4==0&&o&&(i[s++]=r>>16&255,i[s++]=r>>8&255,i[s++]=255&r),r=r<<6|"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(e.charAt(o));var a=n%4*6;return 0===a?(i[s++]=r>>16&255,i[s++]=r>>8&255,i[s++]=255&r):18===a?(i[s++]=r>>10&255,i[s++]=r>>2&255):12===a&&(i[s++]=r>>4&255),i}},{}],18:[function(t,e,n){"use strict";e.exports=function(t,e,n){for(var i,r,s,o=e*n,a=new Uint16Array(o),l=0;l<o;l++)s=t[4*l+2],a[l]=257*(((i=t[4*l])>=(r=t[4*l+1])&&i>=s?i:r>=s&&r>=i?r:s)+(i<=r&&i<=s?i:r<=s&&r<=i?r:s))>>1;return a}},{}],19:[function(t,e,n){"use strict";e.exports={name:"unsharp_mask",fn:t("./unsharp_mask"),wasm_fn:t("./unsharp_mask_wasm"),wasm_src:t("./unsharp_mask_wasm_base64")}},{"./unsharp_mask":20,"./unsharp_mask_wasm":21,"./unsharp_mask_wasm_base64":22}],20:[function(t,e,n){"use strict";var i=t("glur/mono16"),r=t("./hsl_l16");e.exports=function(t,e,n,s,o,a){var l,u,c,h,d,f,p,g,b,m,A,_,v;if(!(0===s||o<.5)){o>2&&(o=2);var y=r(t,e,n),w=new Uint16Array(y);i(w,e,n,o);for(var C=s/100*4096+.5|0,I=257*a|0,E=e*n,x=0;x<E;x++)_=2*(y[x]-w[x]),Math.abs(_)>=I&&(c=t[2+(v=4*x)],f=257*((g=(l=t[v])>=(u=t[v+1])&&l>=c?l:u>=l&&u>=c?u:c)+(p=l<=u&&l<=c?l:u<=l&&u<=c?u:c))>>1,p===g?h=d=0:(d=f<=32767?4095*(g-p)/(g+p)|0:4095*(g-p)/(510-g-p)|0,h=l===g?65535*(u-c)/(6*(g-p))|0:u===g?21845+(65535*(c-l)/(6*(g-p))|0):43690+(65535*(l-u)/(6*(g-p))|0)),(f+=C*_+2048>>12)>65535?f=65535:f<0&&(f=0),0===d?l=u=c=f>>8:(b=2*f-(m=f<=32767?f*(4096+d)+2048>>12:f+((65535-f)*d+2048>>12))>>8,m>>=8,l=(A=h+21845&65535)>=43690?b:A>=32767?b+(6*(m-b)*(43690-A)+32768>>16):A>=10922?m:b+(6*(m-b)*A+32768>>16),u=(A=65535&h)>=43690?b:A>=32767?b+(6*(m-b)*(43690-A)+32768>>16):A>=10922?m:b+(6*(m-b)*A+32768>>16),c=(A=h-21845&65535)>=43690?b:A>=32767?b+(6*(m-b)*(43690-A)+32768>>16):A>=10922?m:b+(6*(m-b)*A+32768>>16)),t[v]=l,t[v+1]=u,t[v+2]=c)}}},{"./hsl_l16":18,"glur/mono16":14}],21:[function(t,e,n){"use strict";e.exports=function(t,e,n,i,r,s){if(!(0===i||r<.5)){r>2&&(r=2);var o=e*n,a=4*o,l=2*o,u=2*o,c=4*Math.max(e,n),h=a,d=h+l,f=d+u,p=f+u,g=p+c,b=this.__instance("unsharp_mask",a+l+2*u+c+32,{exp:Math.exp}),m=new Uint32Array(t.buffer);new Uint32Array(this.__memory.buffer).set(m);var A=b.exports.hsl_l16||b.exports._hsl_l16;A(0,h,e,n),(A=b.exports.blurMono16||b.exports._blurMono16)(h,d,f,p,g,e,n,r),(A=b.exports.unsharp||b.exports._unsharp)(0,0,h,d,e,n,i,s),m.set(new Uint32Array(this.__memory.buffer,0,o))}}},{}],22:[function(t,e,n){"use strict";e.exports="AGFzbQEAAAABMQZgAXwBfGACfX8AYAZ/f39/f38AYAh/f39/f39/fQBgBH9/f38AYAh/f39/f39/fwACGQIDZW52A2V4cAAAA2VudgZtZW1vcnkCAAEDBgUBAgMEBQQEAXAAAAdMBRZfX2J1aWxkX2dhdXNzaWFuX2NvZWZzAAEOX19nYXVzczE2X2xpbmUAAgpibHVyTW9ubzE2AAMHaHNsX2wxNgAEB3Vuc2hhcnAABQkBAAqJEAXZAQEGfAJAIAFE24a6Q4Ia+z8gALujIgOaEAAiBCAEoCIGtjgCECABIANEAAAAAAAAAMCiEAAiBbaMOAIUIAFEAAAAAAAA8D8gBKEiAiACoiAEIAMgA6CiRAAAAAAAAPA/oCAFoaMiArY4AgAgASAEIANEAAAAAAAA8L+gIAKioiIHtjgCBCABIAQgA0QAAAAAAADwP6AgAqKiIgO2OAIIIAEgBSACoiIEtow4AgwgASACIAegIAVEAAAAAAAA8D8gBqGgIgKjtjgCGCABIAMgBKEgAqO2OAIcCwu3AwMDfwR9CHwCQCADKgIUIQkgAyoCECEKIAMqAgwhCyADKgIIIQwCQCAEQX9qIgdBAEgiCA0AIAIgAC8BALgiDSADKgIYu6IiDiAJuyIQoiAOIAq7IhGiIA0gAyoCBLsiEqIgAyoCALsiEyANoqCgoCIPtjgCACACQQRqIQIgAEECaiEAIAdFDQAgBCEGA0AgAiAOIBCiIA8iDiARoiANIBKiIBMgAC8BALgiDaKgoKAiD7Y4AgAgAkEEaiECIABBAmohACAGQX9qIgZBAUoNAAsLAkAgCA0AIAEgByAFbEEBdGogAEF+ai8BACIIuCINIAu7IhGiIA0gDLsiEqKgIA0gAyoCHLuiIg4gCrsiE6KgIA4gCbsiFKKgIg8gAkF8aioCALugqzsBACAHRQ0AIAJBeGohAiAAQXxqIQBBACAFQQF0ayEHIAEgBSAEQQF0QXxqbGohBgNAIAghAyAALwEAIQggBiANIBGiIAO4Ig0gEqKgIA8iECAToqAgDiAUoqAiDyACKgIAu6CrOwEAIAYgB2ohBiAAQX5qIQAgAkF8aiECIBAhDiAEQX9qIgRBAUoNAAsLCwvfAgIDfwZ8AkAgB0MAAAAAWw0AIARE24a6Q4Ia+z8gB0MAAAA/l7ujIgyaEAAiDSANoCIPtjgCECAEIAxEAAAAAAAAAMCiEAAiDraMOAIUIAREAAAAAAAA8D8gDaEiCyALoiANIAwgDKCiRAAAAAAAAPA/oCAOoaMiC7Y4AgAgBCANIAxEAAAAAAAA8L+gIAuioiIQtjgCBCAEIA0gDEQAAAAAAADwP6AgC6KiIgy2OAIIIAQgDiALoiINtow4AgwgBCALIBCgIA5EAAAAAAAA8D8gD6GgIgujtjgCGCAEIAwgDaEgC6O2OAIcIAYEQCAFQQF0IQogBiEJIAIhCANAIAAgCCADIAQgBSAGEAIgACAKaiEAIAhBAmohCCAJQX9qIgkNAAsLIAVFDQAgBkEBdCEIIAUhAANAIAIgASADIAQgBiAFEAIgAiAIaiECIAFBAmohASAAQX9qIgANAAsLC7wBAQV/IAMgAmwiAwRAQQAgA2shBgNAIAAoAgAiBEEIdiIHQf8BcSECAn8gBEH/AXEiAyAEQRB2IgRB/wFxIgVPBEAgAyIIIAMgAk8NARoLIAQgBCAHIAIgA0kbIAIgBUkbQf8BcQshCAJAIAMgAk0EQCADIAVNDQELIAQgByAEIAMgAk8bIAIgBUsbQf8BcSEDCyAAQQRqIQAgASADIAhqQYECbEEBdjsBACABQQJqIQEgBkEBaiIGDQALCwvTBgEKfwJAIAazQwAAgEWUQwAAyEKVu0QAAAAAAADgP6CqIQ0gBSAEbCILBEAgB0GBAmwhDgNAQQAgAi8BACADLwEAayIGQQF0IgdrIAcgBkEASBsgDk8EQCAAQQJqLQAAIQUCfyAALQAAIgYgAEEBai0AACIESSIJRQRAIAYiCCAGIAVPDQEaCyAFIAUgBCAEIAVJGyAGIARLGwshCAJ/IAYgBE0EQCAGIgogBiAFTQ0BGgsgBSAFIAQgBCAFSxsgCRsLIgogCGoiD0GBAmwiEEEBdiERQQAhDAJ/QQAiCSAIIApGDQAaIAggCmsiCUH/H2wgD0H+AyAIayAKayAQQYCABEkbbSEMIAYgCEYEQCAEIAVrQf//A2wgCUEGbG0MAQsgBSAGayAGIARrIAQgCEYiBhtB//8DbCAJQQZsbUHVqgFBqtUCIAYbagshCSARIAcgDWxBgBBqQQx1aiIGQQAgBkEAShsiBkH//wMgBkH//wNIGyEGAkACfwJAIAxB//8DcSIFBEAgBkH//wFKDQEgBUGAIGogBmxBgBBqQQx2DAILIAZBCHYiBiEFIAYhBAwCCyAFIAZB//8Dc2xBgBBqQQx2IAZqCyIFQQh2IQcgBkEBdCAFa0EIdiIGIQQCQCAJQdWqAWpB//8DcSIFQanVAksNACAFQf//AU8EQEGq1QIgBWsgByAGa2xBBmxBgIACakEQdiAGaiEEDAELIAchBCAFQanVAEsNACAFIAcgBmtsQQZsQYCAAmpBEHYgBmohBAsCfyAGIgUgCUH//wNxIghBqdUCSw0AGkGq1QIgCGsgByAGa2xBBmxBgIACakEQdiAGaiAIQf//AU8NABogByIFIAhBqdUASw0AGiAIIAcgBmtsQQZsQYCAAmpBEHYgBmoLIQUgCUGr1QJqQf//A3EiCEGp1QJLDQAgCEH//wFPBEBBqtUCIAhrIAcgBmtsQQZsQYCAAmpBEHYgBmohBgwBCyAIQanVAEsEQCAHIQYMAQsgCCAHIAZrbEEGbEGAgAJqQRB2IAZqIQYLIAEgBDoAACABQQFqIAU6AAAgAUECaiAGOgAACyADQQJqIQMgAkECaiECIABBBGohACABQQRqIQEgC0F/aiILDQALCwsL"},{}],23:[function(t,e,n){"use strict";var i;e.exports=function(){if(void 0!==i)return i;if(i=!1,"undefined"==typeof WebAssembly)return i;try{var t=new Uint8Array([0,97,115,109,1,0,0,0,1,6,1,96,1,127,1,127,3,2,1,0,5,3,1,0,1,7,8,1,4,116,101,115,116,0,0,10,16,1,14,0,32,0,65,1,54,2,0,32,0,40,2,0,11]),e=new WebAssembly.Module(t);return 0!==new WebAssembly.Instance(e,{}).exports.test(4)&&(i=!0),i}catch(n){}return i}},{}],24:[function(t,e,n){"use strict";var i=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable;function o(t){if(null==t)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(t)}e.exports=function(){try{if(!Object.assign)return!1;var t=new String("abc");if(t[5]="de","5"===Object.getOwnPropertyNames(t)[0])return!1;for(var e={},n=0;n<10;n++)e["_"+String.fromCharCode(n)]=n;if("0123456789"!==Object.getOwnPropertyNames(e).map((function(t){return e[t]})).join(""))return!1;var i={};return"abcdefghijklmnopqrst".split("").forEach((function(t){i[t]=t})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},i)).join("")}catch(r){return!1}}()?Object.assign:function(t,e){for(var n,a,l=o(t),u=1;u<arguments.length;u++){for(var c in n=Object(arguments[u]))r.call(n,c)&&(l[c]=n[c]);if(i){a=i(n);for(var h=0;h<a.length;h++)s.call(n,a[h])&&(l[a[h]]=n[a[h]])}}return l}},{}],25:[function(t,e,n){var i=arguments[3],r=arguments[4],s=arguments[5],o=JSON.stringify;e.exports=function(t,e){for(var n,a=Object.keys(s),l=0,u=a.length;l<u;l++){var c=s[d=a[l]].exports;if(c===t||c&&c.default===t){n=d;break}}if(!n){n=Math.floor(Math.pow(16,8)*Math.random()).toString(16);var h={};for(l=0,u=a.length;l<u;l++){var d;h[d=a[l]]=d}r[n]=["function(require,module,exports){"+t+"(self); }",h]}var f=Math.floor(Math.pow(16,8)*Math.random()).toString(16),p={};p[n]=n,r[f]=["function(require,module,exports){var f = require("+o(n)+");(f.default ? f.default : f)(self);}",p];var g={};!function t(e){for(var n in g[e]=!0,r[e][1]){var i=r[e][1][n];g[i]||t(i)}}(f);var b="("+i+")({"+Object.keys(g).map((function(t){return o(t)+":["+r[t][0]+","+o(r[t][1])+"]"})).join(",")+"},{},["+o(f)+"])",m=window.URL||window.webkitURL||window.mozURL||window.msURL,A=new Blob([b],{type:"text/javascript"});if(e&&e.bare)return A;var _=m.createObjectURL(A),v=new Worker(_);return v.objectURL=_,v}},{}],"/index.js":[function(t,e,n){"use strict";function i(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}var r=t("object-assign"),s=t("webworkify"),o=t("./lib/mathlib"),a=t("./lib/pool"),l=t("./lib/utils"),u=t("./lib/worker"),c=t("./lib/stepper"),h=t("./lib/tiler"),d={},f=!1;try{"undefined"!=typeof navigator&&navigator.userAgent&&(f=navigator.userAgent.indexOf("Safari")>=0)}catch(y){}var p=1;"undefined"!=typeof navigator&&(p=Math.min(navigator.hardwareConcurrency||1,4));var g,b,m={tile:1024,concurrency:p,features:["js","wasm","ww"],idle:2e3,createCanvas:function(t,e){var n=document.createElement("canvas");return n.width=t,n.height=e,n}},A={quality:3,alpha:!1,unsharpAmount:0,unsharpRadius:0,unsharpThreshold:0};function _(){return{value:s(u),destroy:function(){if(this.value.terminate(),"undefined"!=typeof window){var t=window.URL||window.webkitURL||window.mozURL||window.msURL;t&&t.revokeObjectURL&&this.value.objectURL&&t.revokeObjectURL(this.value.objectURL)}}}}function v(t){if(!(this instanceof v))return new v(t);this.options=r({},m,t||{});var e="lk_".concat(this.options.concurrency);this.__limit=d[e]||l.limiter(this.options.concurrency),d[e]||(d[e]=this.__limit),this.features={js:!1,wasm:!1,cib:!1,ww:!1},this.__workersPool=null,this.__requested_features=[],this.__mathlib=null}v.prototype.init=function(){var e=this;if(this.__initPromise)return this.__initPromise;if(!1!==g&&!0!==g&&(g=!1,"undefined"!=typeof ImageData&&"undefined"!=typeof Uint8ClampedArray))try{new ImageData(new Uint8ClampedArray(400),10,10),g=!0}catch(c){}!1!==b&&!0!==b&&(b=!1,"undefined"!=typeof ImageBitmap&&(ImageBitmap.prototype&&ImageBitmap.prototype.close?b=!0:this.debug("ImageBitmap does not support .close(), disabled")));var n=this.options.features.slice();if(n.indexOf("all")>=0&&(n=["cib","wasm","js","ww"]),this.__requested_features=n,this.__mathlib=new o(n),n.indexOf("ww")>=0&&"undefined"!=typeof window&&"Worker"in window)try{t("webworkify")((function(){})).terminate(),this.features.ww=!0;var i="wp_".concat(JSON.stringify(this.options));d[i]?this.__workersPool=d[i]:(this.__workersPool=new a(_,this.options.idle),d[i]=this.__workersPool)}catch(c){}var s,u=this.__mathlib.init().then((function(t){r(e.features,t.features)}));return s=b?l.cib_support(this.options.createCanvas).then((function(t){e.features.cib&&n.indexOf("cib")<0?e.debug("createImageBitmap() resize supported, but disabled by config"):n.indexOf("cib")>=0&&(e.features.cib=t)})):Promise.resolve(!1),this.__initPromise=Promise.all([u,s]).then((function(){return e})),this.__initPromise},v.prototype.resize=function(t,e,n){var s=this;this.debug("Start resize...");var o=r({},A);if(isNaN(n)?n&&(o=r(o,n)):o=r(o,{quality:n}),o.toWidth=e.width,o.toHeight=e.height,o.width=t.naturalWidth||t.width,o.height=t.naturalHeight||t.height,0===e.width||0===e.height)return Promise.reject(new Error("Invalid output size: ".concat(e.width,"x").concat(e.height)));o.unsharpRadius>2&&(o.unsharpRadius=2);var a=!1,u=null;o.cancelToken&&(u=o.cancelToken.then((function(t){throw a=!0,t}),(function(t){throw a=!0,t})));var d=Math.ceil(Math.max(3,2.5*o.unsharpRadius|0));return this.init().then((function(){if(a)return u;if(s.features.cib){var n=e.getContext("2d",{alpha:Boolean(o.alpha)});return s.debug("Resize via createImageBitmap()"),createImageBitmap(t,{resizeWidth:o.toWidth,resizeHeight:o.toHeight,resizeQuality:l.cib_quality_name(o.quality)}).then((function(t){if(a)return u;if(!o.unsharpAmount)return n.drawImage(t,0,0),t.close(),n=null,s.debug("Finished!"),e;s.debug("Unsharp result");var i=s.options.createCanvas(o.toWidth,o.toHeight),r=i.getContext("2d",{alpha:Boolean(o.alpha)});r.drawImage(t,0,0),t.close();var l=r.getImageData(0,0,o.toWidth,o.toHeight);return s.__mathlib.unsharp_mask(l.data,o.toWidth,o.toHeight,o.unsharpAmount,o.unsharpRadius,o.unsharpThreshold),n.putImageData(l,0,0),i.width=i.height=0,l=r=i=n=null,s.debug("Finished!"),e}))}var p={},m=function(t,e,n){var i,r,o,c=!1;return Promise.resolve().then((function(){if(o=e.getContext("2d",{alpha:Boolean(n.alpha)}),l.isCanvas(t))return i=t.getContext("2d",{alpha:Boolean(n.alpha)}),null;if(l.isImageBitmap(t))return r=t,c=!0,null;if(l.isImage(t))return b?(s.debug("Decode image via createImageBitmap"),createImageBitmap(t).then((function(t){r=t})).catch((function(t){return null}))):null;throw new Error('Pica: ".from" should be Image, Canvas or ImageBitmap')})).then((function(){if(a)return u;s.debug("Calculate tiles");var b=h({width:n.width,height:n.height,srcTileSize:s.options.tile,toWidth:n.toWidth,toHeight:n.toHeight,destTileBorder:d}).map((function(e){return function(e){return s.__limit((function(){if(a)return u;var c;if(l.isCanvas(t))s.debug("Get tile pixel data"),c=i.getImageData(e.x,e.y,e.width,e.height);else{s.debug("Draw tile imageBitmap/image to temporary canvas");var h=s.options.createCanvas(e.width,e.height),d=h.getContext("2d",{alpha:Boolean(n.alpha)});d.globalCompositeOperation="copy",d.drawImage(r||t,e.x,e.y,e.width,e.height,0,0,e.width,e.height),s.debug("Get tile pixel data"),c=d.getImageData(0,0,e.width,e.height),h.width=h.height=0,d=h=null}var b={src:c.data,width:e.width,height:e.height,toWidth:e.toWidth,toHeight:e.toHeight,scaleX:e.scaleX,scaleY:e.scaleY,offsetX:e.offsetX,offsetY:e.offsetY,quality:n.quality,alpha:n.alpha,unsharpAmount:n.unsharpAmount,unsharpRadius:n.unsharpRadius,unsharpThreshold:n.unsharpThreshold};return s.debug("Invoke resize math"),Promise.resolve().then((function(){return function(t){return Promise.resolve().then((function(){return s.features.ww?new Promise((function(e,n){var i=s.__workersPool.acquire();u&&u.catch((function(t){return n(t)})),i.value.onmessage=function(t){i.release(),t.data.err?n(t.data.err):e(t.data.result)},i.value.postMessage({opts:t,features:s.__requested_features,preload:{wasm_nodule:s.__mathlib.__}},[t.src.buffer])})):s.__mathlib.resizeAndUnsharp(t,p)}))}(b)})).then((function(t){if(a)return u;var n;if(c=null,s.debug("Convert raw rgba tile result to ImageData"),g)n=new ImageData(new Uint8ClampedArray(t),e.toWidth,e.toHeight);else if((n=o.createImageData(e.toWidth,e.toHeight)).data.set)n.data.set(t);else for(var i=n.data.length-1;i>=0;i--)n.data[i]=t[i];return s.debug("Draw tile"),f?o.putImageData(n,e.toX,e.toY,e.toInnerX-e.toX,e.toInnerY-e.toY,e.toInnerWidth+1e-5,e.toInnerHeight+1e-5):o.putImageData(n,e.toX,e.toY,e.toInnerX-e.toX,e.toInnerY-e.toY,e.toInnerWidth,e.toInnerHeight),null}))}))}(e)}));function m(){r&&(c||r.close(),r=null)}return s.debug("Process tiles"),Promise.all(b).then((function(){return s.debug("Finished!"),m(),e}),(function(t){throw m(),t}))}))};return function t(e,n,o,l){if(a)return u;var c,h,d,f=(h=e.shift(),d=2,function(t){if(Array.isArray(t))return t}(h)||function(t,e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t)){var n=[],i=!0,r=!1,s=void 0;try{for(var o,a=t[Symbol.iterator]();!(i=(o=a.next()).done)&&(n.push(o.value),!e||n.length!==e);i=!0);}catch(l){r=!0,s=l}finally{try{i||null==a.return||a.return()}finally{if(r)throw s}}return n}}(h,d)||function(t,e){if(t){if("string"==typeof t)return i(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?i(t,e):void 0}}(h,d)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),p=f[0],g=f[1],b=0===e.length;return l=r({},l,{toWidth:p,toHeight:g,quality:b?l.quality:Math.min(1,l.quality)}),b||(c=s.options.createCanvas(p,g)),m(n,b?o:c,l).then((function(){return b?o:(l.width=p,l.height=g,t(e,c,o,l))})).then((function(t){return c&&(c.width=c.height=0),t}))}(c(o.width,o.height,o.toWidth,o.toHeight,s.options.tile,d),t,e,o)}))},v.prototype.resizeBuffer=function(t){var e=this,n=r({},A,t);return this.init().then((function(){return e.__mathlib.resizeAndUnsharp(n)}))},v.prototype.toBlob=function(t,e,n){return e=e||"image/png",new Promise((function(i){if(t.toBlob)t.toBlob((function(t){return i(t)}),e,n);else if(t.convertToBlob)i(t.convertToBlob({type:e,quality:n}));else{for(var r=atob(t.toDataURL(e,n).split(",")[1]),s=r.length,o=new Uint8Array(s),a=0;a<s;a++)o[a]=r.charCodeAt(a);i(new Blob([o],{type:e}))}}))},v.prototype.debug=function(){},e.exports=v},{"./lib/mathlib":1,"./lib/pool":9,"./lib/stepper":10,"./lib/tiler":11,"./lib/utils":12,"./lib/worker":13,"object-assign":24,webworkify:25}]},{},[])("/index.js")}}]);